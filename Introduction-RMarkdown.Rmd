---
title: "Introduction to RMarkdown"
author: "Milan Malfait"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
    html_document:
      code_download: true
      theme: cosmo
      toc: true
      toc_float: true
      highlight: tango
      number_sections: false
---

# `.Rmd` documents

With RMarkdown it is easy to create documents or webpages that include text, code and plots. During the practical sessions we will work with RMarkdown, and not with `R` scripts. RMarkdown allows you to combine the code required to produce an analysis, its results, visualizations and descriptive text all in one document.

For a detailed guide on RMarkdown see [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/). Most of the contents discussed here come from that source.

## Metadata

The markdown notebook will start with a [YAML](https://en.wikipedia.org/wiki/YAML) header, which includes the title, names of the authors and type of RMarkdown file. We typically work with `html_document` (the default).

``` yaml
---
title: "Title"
author: "Author names"
date: "Date"
output:  html_document
---
```

The `html_document` output specifies that your document will be converted to HTML when you "knit" or compile it. 


## Compiling an R Markdown file

Essentially, an .Rmd file is just a plain text file used to store all your text and code needed to produce your final report. Although RStudio allows you to preview the output of your code, the output is not itself part of the .Rmd file. When you save and close your Rmd file and open it again later or send it to someone, the output will have disappeared (although also here, RStudio has some tricks to keep the output). The way to properly generate the output version of your Rmd file is by __compiling__ it. This can be done in RStudio by pressing the `Knit` button in the toolbar, or by pressing `Shift + Ctrl + K` (Mac: `Shift + Cmd + K`). This will produce an HTML file with the same name as your Rmd and located in the same folder. You can open this file in any internet browser (you don't need an internet connection since it's a local file) and marvel at the nicely formatted output of your hard work. Another advantage of working with RStudio is that it will open this file automatically, either in a new window or in the "Viewer" pane (you can change this in the RStudio settings).

__Important__: saving your Rmd file does __not__ update the corresponding HTML file automatically. In contrast, when you compile ("Knit"), your Rmd file will be saved first. 

While editing you generally want to save often (you don't want to lose stuff if something goes wrong) but you don't need to compile every time you make a minor change, unless you  want to see what the output will look like.


## Formatting text

### Bold and italic text

Text in an R Markdown document (i.e. everything that is not considered code) is written in [Markdown syntax](https://bookdown.org/yihui/rmarkdown/markdown-syntax.html). This enables you to format text by surrounding it with special characters.

*Italic text* is generated by surrounding the text with a pair of either underscores (`_text_`) or asterisks (`*text*`). **Bold text** uses a pair of double underscores (`__text__`) or asterisks (`**text**`). __*Bold italic text*__ can be achieved by using a combination of the two (`__*text*__`).

### Lists

Unordered list items start with `*`, `-`, or `+`, and you can nest one list within another list by indenting the sub-list, for example:

```markdown
- one item
- one item
- one item
    * one more item
    * one more item
    * one more item
```

The output of the above syntax would be:

- one item
- one item
- one item
    * one more item
    * one more item
    * one more item


A numbered list can be created by starting each item with a number:

```markdown
1. the first item
2. the second item
3. the third item
```

Output:

1. the first item
2. the second item
3. the third item

__Note:__ make sure to leave an empty line between text and a list for correct formatting.


### Section headers

Section headers can be written using a number of \# signs, where the amount of \#'s specifies the level: 

```markdown
# Main section title: first level

## Subsection: second level

### Sub-subsection: third level

#### Sub-sub-subsection: fourth level
```

The output:

# Main section title: first level

## Subsection: second level

### Sub-subsection: third level

#### Sub-sub-subsection: fourth level

In general it's not recommended to go further than 4 sub-levels of sections.

Note that you can also include a [table of contents](https://bookdown.org/yihui/rmarkdown/html-document.html#table-of-contents) at the top of your file by specifying `toc: true` in the YAML header.


## Integrating text and R code

You can insert chunks of R code in your RMarkdown file by wrapping a code block inside ```` ```{r} ```` and ```` ``` ````.

In RStudio this is easily done by using the `Insert` button in the toolbar or the keyboard shorcut `Ctrl + Alt + I` (`Cmd + Option + I` on macOS).

For more information, see [section 2.6](https://bookdown.org/yihui/rmarkdown/r-code.html) of *The Definitive Guide*

We will demonstrete the use of R-code with various examples in the sections below so that you can familiarise yourself with the syntax.


# Basic R stuff

## Simple calculations

R can be used as a simple calculator. Executing code can be done in various ways. To execute the entire chunk of code:

 - In RStudio: click the green arrow in the upper right corner of the code chunk
 - Place your cursor inside the chunk and press `Shift + Ctrl + Enter` (Mac: `Shift + Cmd + Enter`)
 
Code can also be run line by line by selecting a line with your cursor and pressing `Ctrl + Enter` (Mac: `Cmd + Enter`).

Try executing the code below using both ways: line-by-line and the entire chunk.

```{r}
1+1
(5-3)+7*10/2
```

The output should be displayed either right below the code chunk or in the R console. You can change this behaviour by selecting the settings gear in the RStudio toolbar and selecting `Chunk Output Inline` or `Chunk Output in Console`.

You can also run all chunks in you Rmd file by pressing the `Run` button in the toolbar (upper right) and then select `Run All` (or using the keyboard shortcut `Shift + Ctrl + R` on Windows or `Shift + Cmd + R` on Mac). Note that this menu also provides additional ways of running R chunks, the most useful ones being:

  * `Run All Chunks Above`: this executes all code chunks preceding your cursor location, starting at the top and tehn running down.
  * `Restart R and Run All Chunks`: this will restart R and re-run your entire document. Note that this will __remove all current objects and data from memory__ and re-starting R in a blank state. This means that any code that was run in the console and not saved in a code chunk will be lost. This might seem scary at first, but there are very good reasons to do this often. You can read more about this workflow [here](https://rstats.wtf/save-source.html#restart-r-often-during-development).

## Commenting R code

You can add comments to your R code by starting a line with \#. This is useful to describe what your code is doing (or should be doing). Annotating your code this way is very useful to communicate both with others and your future self. Try to keep these comments clear but short. Longer descriptions should go in the main text of your RMarkdown file. Commenting also provides a way of "disabling" code without having to remove it. Note that each new line of a comment should be preceded by a \#. You can easily "comment out" multiple lines by selecting them and pressing `Shift + Ctrl + C` (Mac: `Shift + Cmd + C`).

Try running the chunk below and verify that it does not produce any output. What happens if you remove one of the \# signs?

```{r}
# This is a comment

# This is a very long comment split over
# multiple lines

# Code inside a comment is not executed
# 1+1
```


## Assigning objects to save results and perform calculations

You can save results of function calls or calculations by assigning the value to a *variable* using the assign operator `<-`.

Run the code below and verify the value of `c`. You can also check the value of a variable by entering it in the Console and pressing `Enter`. 

```{r}
a <- 2
b <- 3
c <- a + b
c
```

Note that in principle, you can also use `=` for assignment, but this is considered to be bad practice because the equal sign is reserved for function arguments (see next section). So you should always use `<-` for assignment.

**Hint:** a quick and easy way to type `<-` in RStudio is by using the shortcut `Alt + -` (Mac: `Option + -`).


## Functions

Functions are commands in R that perform certain tasks. They take inputs in the form of *arguments* and return their results as *output*. They are called using their name, followed by parentheses `()` in which the arguments are specified. There are many built-in functions in R. In addition, you can write your own functions or load other functins through the use of *packages* (more on that later).

As an example, we can use the function `rnorm` to sample 100 draws from a Normal distribution. We assign the result (a vector of 100 random numbers) to a new variable `draws` and display the first 6 values by caling the function `head` on this new variable.

```{r}
# sample 100 numbers from a standard normal distribution 
# (mean = 0, standard deviation = 1)
draws <- rnorm(100)
head(draws)
```


## Getting help in R: `?`

What if instead of drawing from the standard normal distribution we want to sample from a normal with a mean of 5 and a standard deviation of 2? Knowing that `rnorm` is the function to generate normally distributed numbers, we can get more information on it by executing `?rnorm` (usually you would do this in the Console, but for demonstration, we run it inside a code chunk here). This will open up the *help* page for the "The Normal Distribution" and all its related functions inside R, one of which is `rnorm`. 

```{r, eval = FALSE}
?rnorm
```

Read through the documentation, can you figure out how to change the mean and standard deviation?

The solution is to specify the `mean` and `sd` arguments.

```{r}
draws2 <- rnorm(100, mean = 5, sd = 2)
head(draws2)
```

Each built-in R function or functions loaded through a package has a help page. In addition, there is a wealth of information through the wonderful magic of [Google](https://www.google.com/). Another great place to look for answers or ask questions yourself is [StackOverflow](https://stackoverflow.com/).


## Tidyverse

The *tidyverse* is a set of packages designed to make data science in R more user-friendly.
It shares a common philosophy and grammar of doing data science, which can change somewhat from how base R works (though it shouldn't be an excuse to learn how to use base R!!!).

Instead of installing each *tidyverse* package individually, you can install all of them simultaneously by simply calling

```{r, eval=FALSE} 
install.packages("tidyverse")
```

Note that this code won't be executed when compiling this report, because I specified `eval=FALSE` in the [chunk options](https://bookdown.org/yihui/rmarkdown/r-code.html).
Instead it should be called manually, for example in an R console.


For more information see 

- <https://www.tidyverse.org/>
- <https://rafalab.github.io/dsbook/tidyverse.html>
- <https://r4ds.had.co.nz/>



## Visualizations

### Base R

A picture often says more than words (or lines of code output) and R has a rich [visualization toolbox](https://rstudio-pubs-static.s3.amazonaws.com/7953_4e3efd5b9415444ca065b1167862c349.html) that allows us to make powerful visualizations of our data. 

For example, to visually verify that the random numbers we generated earlier (which are still stored in memory under the variables `draws` and `draws2`) are indeed normally distributed, we could make a histogram of them, using the `hist` function.

```{r}
# draws comes from a standard normal (mean = 0, sd = 1)
hist(draws)

# draws 2 comes from a normal with mean = 5, sd = 2
hist(draws2)
```

Note that you can customize these plots in a lot of ways. Looking at the help page of `hist` or doing a quick internet search will take you a long way!


### ggplot2

Although powerful, the base R visualization framework can be somewhat challenging to work with.
A good alternative is the [`ggplot2` package](https://ggplot2.tidyverse.org/), part of the larger `tidyverse` which includes more useful packages for data manipulation and analysis.
`ggplot2` uses a visualization framework based on the [*grammar of graphics* philosophy](https://ggplot2-book.org/introduction.html#what-is-the-grammar-of-graphics), which we won't get further into here but which can be quite an intuitive way to think about data visualizations.

`ggplot2` works best with a `data.frame` as input.
As an example, we'll use the `mtcars` data, which is available by default in every R installation (for more info on this data set, see `?mtcars`).
With just a few lines, we can create already quite elegant visualizations:

```{r}
library(ggplot2)

ggplot(mpg, aes(displ, hwy, colour = class)) + 
  geom_point()
```

You could perfectly recreate this plot with base R, but it's going to take more lines of code and potential headaches.
Still, both frameworks have their strengths and weaknesses and they are complementary in many ways, so it pays to learn both of them rather than stubbornly sticking to one.

There are tons of documentation and tutorials on `ggplot2` to be found online.
A good place to start is <https://ggplot2.tidyverse.org/>.


## Importing data

See <https://r4ds.had.co.nz/data-import.html>.

Note that both the base `read.csv` and the *tidyverse* equivalent `readr::read_csv()` can both use URLs to read in data.
That way you don't have to download the data locally on your machine or worry about different versions.

```{r}
## Example from HDA2020 course (https://statomics.github.io/HDA2020/)
uk_foods <- readr::read_csv(
  file = "https://raw.githubusercontent.com/statOmics/HDA2020/data/ukFoods.csv",
  col_names = TRUE,
  col_types = cols()
)
uk_foods
```



## Summary of data

To get a quick summary of the data, you can use the `summary` function. This will return some summary statistics for the columns present in the data.

```{r}
## iris is a default data set available in R
## To get more info, use `?iris`
summary(iris)
class(iris)
```


## Subsetting data

You can select subsets of a `data.frame` by using square brackets `[]` and specifying the number(s) of the row(s) or column(s) you want to select. Alternatively, you can use the dollar sign `$` to select a column using its name.

To reduce the output printed out, we will first make a subset of the `iris` data containing just the first 10 rows.

```{r}
# make subset of data to prevent long outputs
iris_sub <- iris[1:10, ]
iris_sub

# Select first column, single brackets returns data.frame
iris_sub[1]
iris_sub["Sepal.Length"]
# double brackets returns vector
iris_sub[[1]]
iris_sub[["Sepal.Length"]]
# using the dollar sign, also returns vector
iris_sub$Sepal.Length

# Select all columns except the first one
iris_sub[-1]

# Selecting rows
iris_sub[1, ] # Select the first row
iris_sub[1:5,] # Select the first five rows
iris_sub[c(2, 4), ] # select the second and fourth rows

# columns and rows
iris_sub[1:5, "Sepal.Length"] # first 5 rows of "Sepal.Length" column
iris_sub[3, 2]  # third row, second column
```


## Including R object values or results in the text

You can add inline R code results by wrapping them inside `` `r ` ``. This is useful for discussing the value of a result in your text. Instead of having to copy the value of a result (which is prone to error and not robust to changes), you can just call it inside the text. For example, we could calculate the mean sepal length of the iris flowers as follow:

```{r}
mean(iris$Sepal.Length)
```

We could copy the value inside our text, but a better way is by just running the code inline as `mean(iris$Sepal.Length)` surrounded by `` `r `` and `` ` ``. So we could say that the iris flowers in our data have a mean length of `r mean(iris$Sepal.Length)`.

Note: to actually see the value of the inline code, place your cursor inside the backticks `` ` `r `` and press `Ctrl + Enter` or `Cmd + Enter`. When you knit your Rmd file and build the HTML output, the inline R code will be replaced by its output value.


## Including equations

Finally, you can include equations in your text using [LaTeX](https://en.wikipedia.org/wiki/LaTeX) syntax and surrounding it by  a pair of double dollar signs `$$`. This is useful to specify models. For example, we can write the equation of a linear model as

```
$$
y_i = \beta_0 + \beta_1 x_i + \epsilon_i
$$
```

Which will be converted to the following output:

$$
y_i = \beta_0 + \beta_1 x_i + \epsilon_i
$$

Note that RStudio will give you a preview of what your equation will look like in the final document.

You can also include inline $\LaTeX$ equations by using a pair of single `$` signs. For example, the following sentence:

`The sample mean of $y$ is given by $\bar{y}=\sum\limits_{i=1}^{n}\frac{y_i}{n}$`

Will be converted to:

The sample mean of $y$ is given by $\bar{y}=\sum\limits_{i=1}^{n}\frac{y_i}{n}$



# Useful resources

- [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
- [R for Data Science](https://r4ds.had.co.nz/) by Hadley Wickham (main author of the `tidyverse` packages)
- [Introduction to Data Science](https://rafalab.github.io/dsbook/) by Rafael Irizarry
- [What They Forgot to Teach You About R](https://rstats.wtf/), for some useful "good practices" tips when working with R



# Session Info

Finally, it's always good practice to include the [Session Info]() for your R session in your document.
That way, other persons (including your future self) looking at your document can see what versions of R and loaded packages were used, which can be quite essential for reproducibility.
There are 2 options, either using the base R command `sessionInfo()` or using [the version from the `devtools` package](https://devtools.r-lib.org/reference/session_info.html): `devtools::session_info()`.
Their outputs have slightly different formatting but the contents are essentially the same.
Personally, I prefer the `devtools` version, but this is really a personal choice.

You can also include the date with `Sys.time()` so you have a time stamp of when the report was compiled.
If you happen to be working inside a git repository, `git2r::repository()` is a useful function that displays information about the current `git` state and the last commit. 

```{r session_info, cache=FALSE}
Sys.time()
devtools::session_info()

## only use this when working inside a git repository, don't worry if you don't know what this means
git2r::repository()
```

# [Home](https://statomics.github.io/HDA2020/) {-}
