<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement" />


<title>4. Sparse Singular Value Decomposition</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HDA2020</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro.html">1. Introduction</a>
    </li>
    <li>
      <a href="svd.html">2. Singular Value Decomposition</a>
    </li>
    <li>
      <a href="svdGeometricInterpretation.html">2.3. Geometric Interpretation SVD</a>
    </li>
    <li>
      <a href="MDS_linkGramDistanceMatrix.html">2.7. Link MDS and Gram Distance Matrix</a>
    </li>
    <li>
      <a href="prediction.html">3. Prediction with High Dimensional Predictors</a>
    </li>
    <li>
      <a href="sparseSvd.html">4. Sparse Singular Value Decomposition</a>
    </li>
    <li>
      <a href="lda.html">5. Linear Discriminant Analysis</a>
    </li>
    <li>
      <a href="lsi.html">6. Large Scale Inference</a>
    </li>
    <li>
      <a href="hclust.html">Paper 1: Intro Hierarchical Clustering</a>
    </li>
    <li>
      <a href="em.html">Paper 1: EM algorithm</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-laptop"></span>
     
    Practicals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Lab1-Intro-SVD.html">Lab 1</a>
    </li>
    <li>
      <a href="Lab2-PCA.html">Lab 2</a>
    </li>
    <li>
      <a href="Lab3-Penalized-Regression.html">Lab 3</a>
    </li>
    <li>
      <a href="Lab4-Sparse-PCA-LDA.html">Lab 4</a>
    </li>
    <li>
      <a href="Lab5-Large-Scale-Inference.html">Lab 5</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/HDA2020">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">4. Sparse Singular Value Decomposition</h1>
<h4 class="author">Lieven Clement</h4>
<h4 class="date">statOmics, Ghent University (<a href="https://statomics.github.io" class="uri">https://statomics.github.io</a>)</h4>

</div>


<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>In high dimensional data the PCs may have unclear interpretation because they depend on all <span class="math inline">\(p\)</span> original variables.</p>
<div id="example-toxicogenomics-in-early-drug-development" class="section level2">
<h2><span class="header-section-number">1.1</span> Example: Toxicogenomics in early drug development</h2>
<div id="background" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Background</h3>
<ul>
<li><p>Effect of compound on gene expression.</p></li>
<li><p>Insight in action and toxicity of drug in early phase</p></li>
<li><p>Determine activity with bio-assay: e.g. binding afinity of compound to cellwall recepter (target, IC50).</p></li>
<li><p>Early phase: 20 to 50 compounds</p></li>
<li><p>Based on in vitro results one aims to get insight in how to build better compound (higher on-target activity less toxicity.</p></li>
<li><p>Small variantions in moelculair structure lead to variations in BA and gene expression.</p></li>
<li><p>Aim: Build model to predict bio-activity based on gene expression in liver cell line.</p></li>
</ul>
</div>
<div id="data" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Data</h3>
<ul>
<li><p>30 chemical compounds have been screened for toxicity</p></li>
<li><p>Bioassay data on toxicity screening</p></li>
<li><p>Gene expressions in a liver cell line are profiled for each compound (4000 genes)</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>toxData &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="st">&quot;https://raw.githubusercontent.com/statOmics/HDA2020/data/toxDataCentered.csv&quot;</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="dt">col_types =</span> <span class="kw">cols</span>()</span>
<span id="cb1-4"><a href="#cb1-4"></a>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>svdX &lt;-<span class="st"> </span><span class="kw">svd</span>(toxData[,<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
<p>Data is already centered:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>toxData <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span>colMeans <span class="op">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="st">  </span>range</span></code></pre></div>
<pre><code>## [1] -1.434038e-17  2.567391e-17</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a> toxData <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span>names <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span>head</span></code></pre></div>
<pre><code>## [1] &quot;BA&quot; &quot;X1&quot; &quot;X2&quot; &quot;X3&quot; &quot;X4&quot; &quot;X5&quot;</code></pre>
<ul>
<li>First column contains data on Bioassay.</li>
<li>The higher the score on Bioassay the more toxic the compound</li>
<li>Other columns contain data on gene expression X1, … , X4000</li>
</ul>
</div>
<div id="data-exploration" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Data exploration</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>toxData <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>,<span class="dt">y=</span>BA)) <span class="op">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="st">&quot;jitter&quot;</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>svdX &lt;-<span class="st"> </span>toxData[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span>svd</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>k &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>Vk &lt;-<span class="st"> </span>svdX<span class="op">$</span>v[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb7-6"><a href="#cb7-6"></a>Uk &lt;-<span class="st"> </span>svdX<span class="op">$</span>u[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb7-7"><a href="#cb7-7"></a>Dk &lt;-<span class="st"> </span><span class="kw">diag</span>(svdX<span class="op">$</span>d[<span class="dv">1</span><span class="op">:</span>k])</span>
<span id="cb7-8"><a href="#cb7-8"></a>Zk &lt;-<span class="st"> </span>Uk<span class="op">%*%</span>Dk</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="kw">colnames</span>(Zk) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Z&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw">colnames</span>(Vk) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;V&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a>pca &lt;-<span class="st"> </span>Zk <span class="op">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BA =</span> toxData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(BA)) <span class="op">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> Z1, <span class="dt">y =</span> Z2, <span class="dt">color =</span> BA)) <span class="op">+</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="st">  </span><span class="kw">scale_colour_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">mid=</span><span class="st">&quot;white&quot;</span>,<span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb7-19"><a href="#cb7-19"></a>pca</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<ul>
<li>Scores on the first two principal components (or MDS plot). - Each point corresponds to a compound.</li>
<li>Color code refers to the toxicity score (higher score more toxic).</li>
<li>Clear separation between compounds according to toxicity.</li>
</ul>
<hr />
<ul>
<li>Next logic step in a PCA is to interpret the principal components.</li>
<li>We thus have to assess the loadings.</li>
<li>We can add a vector for each gene to get a biplot, but this would require plotting 4000 vectors, which would render the plot unreadable.</li>
</ul>
<p>Alternative graph to look at the many loadings of the first two PCs.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">grid.arrange</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V1)) <span class="op">+</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) ,</span>
<span id="cb8-8"><a href="#cb8-8"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V2)) <span class="op">+</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ul>
<li><p>It is almost impossible to interpret the PCs because there are 4000 genes contributing to each PC.</p></li>
<li><p>In an attempt to find the most important genes (in the sense that they drive the interpretation of the PCs), the plots show horizontal reference lines: the average of the loadings, and the average ± twice the standard deviation of the loadings. In between the lines we expects about 95% of the loadings (if they were normally distributed).</p></li>
<li><p>The points outside the band come from the genes that have rather large loadings (in absolute value) and hence are important for the interpretation of the PCs.</p></li>
<li><p>Note, that particularly for the first PC, only a few genes show a markedly large loadings that are negative. This means that an upregulation of these genes will lead to low scores on PC1.</p></li>
<li><p>These genes will very likely play an important role in the toxicity mechanism.</p></li>
<li><p>Indeed, low scores on PC1 are in the direction of more toxicity.</p></li>
</ul>
<hr />
</div>
</div>
<div id="sparse-matrix-decomposition" class="section level2">
<h2><span class="header-section-number">1.2</span> Sparse matrix decomposition</h2>
<p>Basic idea of sparse matrix decomposition of an <span class="math inline">\(n \times p\)</span> matrix <span class="math inline">\(\mathbf{X}\)</span>}</p>
<p>Find a rank <span class="math inline">\(k\)</span> approximation of <span class="math inline">\(\mathbf{X}\)</span> of the form <span class="math display">\[
\mathbf{X}_k = \sum_{j=1}^k \delta_j \mathbf{u}_j\mathbf{v}_j^t
\]</span> such that many of the elements in the <span class="math inline">\(\mathbf{v}_j\)</span> and or <span class="math inline">\(\mathbf{u}_j\)</span> are exactly zero.</p>
<p>We focus on the <strong>Penalised Matrix Decomposition</strong> (PMD) method of Witten <em>et al.</em> (2009, Biostatistics, 10, 3, 515-534).</p>
<p>When many of the loadings in <span class="math inline">\(\mathbf{v}_j\)</span> are zero, the interpretation of the PC only depends on the features that correspond to the remaining non-zero loadings.</p>
<hr />
</div>
</div>
<div id="penalised-matrix-decomposition" class="section level1">
<h1><span class="header-section-number">2</span> Penalised Matrix Decomposition</h1>
<div id="rank-1-approximation" class="section level2">
<h2><span class="header-section-number">2.1</span> Rank 1 approximation</h2>
<p>The rank-1 PMD approximation of the <span class="math inline">\(n \times p\)</span> matrix <span class="math inline">\(\mathbf{X}\)</span> is of the form <span class="math display">\[
\mathbf{X}_1 = \delta_1\mathbf{u}_1\mathbf{v}_1^t,
\]</span></p>
<p>and it is the solution to the following minimisation problem: <span class="math display">\[
\min_{\delta,u,v} \Vert \mathbf{X} - \delta\mathbf{u}\mathbf{v}^t\Vert_F^2 \text{ subject to }
\delta \geq 0, \Vert \mathbf{u}\Vert_2^2=\Vert \mathbf{v}\Vert_2^2=1, \Vert\mathbf{u}\Vert_1\leq c_1, \Vert \mathbf{v}\Vert_1 \leq c_2
\]</span></p>
<p>for some user-defined constants <span class="math inline">\(c_1,c_2&gt;0\)</span>.</p>
<p>The constraints <span class="math inline">\(\Vert\mathbf{u}\Vert_1\leq c_1\)</span> and <span class="math inline">\(\Vert \mathbf{v}\Vert_1 \leq c_2\)</span> are known as <span class="math inline">\(L_1\)</span> or lasso constraints.</p>
<p>Note, <span class="math display">\[
\Vert\mathbf{u}\Vert_1\ = \sum_{i=1}^n \vert u_i \vert \text{ and }\Vert\mathbf{v}\Vert_1\ = \sum_{i=1}^p \vert v_i\vert.
\]</span></p>
<p>If <span class="math inline">\(c_1=+\infty\)</span>, then the constraint on <span class="math inline">\(\mathbf{u}\)</span> is removed (similar for <span class="math inline">\(c_2\)</span>).</p>
<hr />
<p>Note that <span class="math display">\[
  \min_{\delta,u,v} \Vert \mathbf{X} - \delta\mathbf{u}\mathbf{v}^t\Vert_F^2 = \min_{A:\text{rank}(A)=1}  \Vert \mathbf{X} - A\Vert_F^2
\]</span> with <span class="math inline">\(A=X_1\)</span> (truncated SVD of <span class="math inline">\(\mathbf{X}\)</span>, truncated after 1 term). However, the PMD requires a constrained minimisation. The unconstrained solution arises with <span class="math inline">\(c_1=c_2=+\infty\)</span>.</p>
<p>Note that <span class="math inline">\(\Vert \mathbf{u}\Vert_2^2=\Vert \mathbf{v}\Vert_2^2=1\)</span> may also be written as <span class="math inline">\(\mathbf{u}^t\mathbf{u}=\mathbf{v}^t\mathbf{v}=1\)</span> (i.e. the vectors are normalised, just like for the singular vectors of the SVD).</p>
<ul>
<li><p>We also applied the <span class="math inline">\(L_1\)</span> constraint to the least-squares estimator of the regression parameters in a linear regression model.</p></li>
<li><p>Effect was that many of the parameter estimates are set exactly to zero.</p></li>
<li><p>Here, the same effect will take place. Many of the elements in <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> will be set exactly to zero.</p></li>
<li><p>In particular, the smaller <span class="math inline">\(c_2\)</span>, the more elements of <span class="math inline">\(\mathbf{v}\)</span> will be set to zero (shrinkage).</p></li>
<li><p>Similarly, the smaller <span class="math inline">\(c_1\)</span>, the more elements of <span class="math inline">\(\mathbf{u}\)</span> will be set to zero.</p></li>
<li><p>The choice of <span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span> depends on the objective of the data analysis and will be discussed later.</p></li>
</ul>
<p>The solution is known as a rank-1 PMD approximation of <span class="math inline">\(\mathbf{X}\)</span> because <span class="math inline">\(\delta_1\mathbf{u}_1\mathbf{v}_1^t\)</span> is a matrix of rank 1.</p>
<hr />
</div>
<div id="rank-2-approximation" class="section level2">
<h2><span class="header-section-number">2.2</span> Rank-2 approximation</h2>
<p>The rank-2 PMD approximation is found as follows:</p>
<ol style="list-style-type: decimal">
<li><p>find the rank-1 PMD as before: <span class="math inline">\(\mathbf{X}_1=\delta_1\mathbf{u}_1\mathbf{v}_1^t\)</span>;</p></li>
<li><p>compute <span class="math display">\[
\tilde{\mathbf{X}}_2 = \mathbf{X}-\mathbf{X}_1,
\]</span></p></li>
</ol>
<p>and compute the rank-1 PMD of <span class="math inline">\(\tilde{\mathbf{X}}_2\)</span>, which gives <span class="math inline">\(\delta_2, \mathbf{u}_2, \mathbf{v}_2\)</span>;</p>
<ol start="3" style="list-style-type: decimal">
<li>the rank-2 PMD of <span class="math inline">\(\mathbf{X}\)</span> is then given by <span class="math display">\[
\mathbf{X}_2 = \delta_1\mathbf{u}_1\mathbf{v}_1^t+\delta_2\mathbf{u}_2\mathbf{v}_2^t.
\]</span></li>
</ol>
<p>Note that the <span class="math inline">\(\mathbf{u}\)</span>’s and <span class="math inline">\(\mathbf{v}\)</span>’s are not necessarily orthogonal (only if <span class="math inline">\(c_1, c_2=+\infty\)</span>).</p>
<hr />
</div>
<div id="rank-k-approximation" class="section level2">
<h2><span class="header-section-number">2.3</span> Rank-k approximation</h2>
<p>The rank-<span class="math inline">\(k\)</span> PMD approximation is found as follows:</p>
<ol style="list-style-type: decimal">
<li><p>find the rank-1 PMD as before: <span class="math inline">\(\tilde{\mathbf{X}}_1=\delta_1\mathbf{u}_1\mathbf{v}_1^t\)</span>;</p></li>
<li><p>set <span class="math inline">\(j=1\)</span>;</p></li>
<li><p>compute <span class="math display">\[
\tilde{\mathbf{X}}_{j+1} = \mathbf{X}-\tilde{\mathbf{X}}_1-\cdots - \tilde{\mathbf{X}}_j,
\]</span> and compute the rank-1 PMD of <span class="math inline">\(\tilde{\mathbf{X}}_{j+1}\)</span>, which gives <span class="math inline">\(\delta_{j+1}, \mathbf{u}_{j+1}, \mathbf{v}_{j+1}\)</span>;</p></li>
<li><p>if <span class="math inline">\(j&lt;k\)</span>, increase <span class="math inline">\(j\)</span> with one and go back to step 3; otherwise go to step 5;</p></li>
<li><p>the rank-<span class="math inline">\(k\)</span> PMD of <span class="math inline">\(\mathbf{X}\)</span> is then given by <span class="math display">\[
  \mathbf{X}_k = \sum_{j=1}^k \delta_j\mathbf{u}_j\mathbf{v}_j^t.
\]</span></p></li>
</ol>
<p>Without the <span class="math inline">\(L_1\)</span> constraints, this algorithm gives the ordinary SVD.</p>
<p>As before the <span class="math inline">\(\delta_j\)</span>s, <span class="math inline">\(\mathbf{u}_j\)</span>s and <span class="math inline">\(\mathbf{v}_j\)</span>s are stacked into matrices <span class="math inline">\(\mathbf{D}_k\)</span>, <span class="math inline">\(\mathbf{U}_k\)</span> and <span class="math inline">\(\mathbf{V}_k\)</span>: <span class="math inline">\(\mathbf{X}_k = \mathbf{U}_k\mathbf{D}_k\mathbf{V}_k^t\)</span>.</p>
<p>Note that the <span class="math inline">\(\mathbf{u}\)</span> vectors are generally not orthogonal (i.e. <span class="math inline">\(\mathbf{u}_i^t\mathbf{u}_j\neq 0\)</span> for <span class="math inline">\(i\neq j\)</span>) (the same holds for the <span class="math inline">\(\mathbf{v}\)</span> vectors).</p>
<hr />
</div>
<div id="sparse-pca-via-pmd" class="section level2">
<h2><span class="header-section-number">2.4</span> Sparse PCA via PMD</h2>
<p>Just like the SVD can be used to find the PCA solution, the PMD can be used to find a sparse PCA solution (SPC).</p>
<p>For a PCA, it is only important to have sparse loadings (in the <span class="math inline">\(\mathbf{v}\)</span>s); the scores (involving the <span class="math inline">\(\mathbf{u}\)</span>s) need not be sparse.</p>
<p>The rank-1 solutions thus satisfy <span class="math display">\[
  \min_{\delta,u,v} \Vert \mathbf{X} - \delta\mathbf{u}\mathbf{v}^t\Vert_F^2 \text{ subject to }
  \delta \geq 0, \Vert \mathbf{u}\Vert_2^2=\Vert \mathbf{v}\Vert_2^2=1, \Vert \mathbf{v}\Vert_1 \leq c
\]</span> (i.e. no sparsity constraint on <span class="math inline">\(\mathbf{u}\)</span>).</p>
<p>Hence the PCA scores <span class="math display">\[
 \mathbf{Z}_k = \mathbf{U}_k\mathbf{D}_k
\]</span> relate to <span class="math inline">\(\mathbf{X}_k\)</span> through the sparse loadings in <span class="math inline">\(\mathbf{V}_k\)</span>.</p>
<hr />
<p>It can be shown that the SPC solution (rank-1) also maximises <span class="math display">\[
  \mathbf{v}^t\mathbf{X}^t\mathbf{X}\mathbf{v} \text{ subject to }
  \Vert \mathbf{u}\Vert_2^2=\Vert \mathbf{v}\Vert_2^2=1, \Vert \mathbf{v}\Vert_1 \leq c
\]</span> (i.e. it maximises the variance of the PCs, subject to sparsity constraint on loadings).</p>
<p>From these two slides we may conclude that we can use the PMD as the basis of a sparse PCA, and that the interpretation is as before in terms of maximising variance. Only now we hope that only a few features will give a non-zero loading in the <span class="math inline">\(\mathbf{v}\)</span>-vectors. Biplots may again be constructed (with fewer vectors to be plotted).</p>
<hr />
</div>
</div>
<div id="toxicogenomics-analysis-with-a-sparse-pca" class="section level1">
<h1><span class="header-section-number">3</span> Toxicogenomics analysis with a sparse PCA</h1>
<div id="spca" class="section level2">
<h2><span class="header-section-number">3.1</span> SPCA</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(PMA)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>spcX &lt;-<span class="st"> </span><span class="kw">SPC</span>(</span>
<span id="cb9-4"><a href="#cb9-4"></a>  toxData[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">    </span>as.matrix,</span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="dt">K=</span><span class="dv">30</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="dt">sumabsv =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## 12345678910111213141516171819
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">barplot</span>(spcX<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span>,<span class="dt">ylab=</span><span class="st">&quot;eigenvalue&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.5</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">barplot</span>(spcX<span class="op">$</span>prop.var.explained,</span>
<span id="cb11-4"><a href="#cb11-4"></a>     <span class="dt">ylab=</span><span class="st">&quot;cummulative variance&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<ul>
<li><p>The plot on the left shows the eigenvalues (squared singular values) from the PMD.</p>
<ul>
<li>This suggests that the first one or two are the most important, but all eigenvalues remain substantially larger than zero.</li>
</ul></li>
<li><p>The figure on the right shows the cumulative percentage of variance retained in the PCs.</p>
<ul>
<li>These percentages are now no longer calculated as before as ratio’s of sums of eigenvalues.</li>
<li>A more complicated calculation is required now, because the PCs are no longer uncorrelated with one another.</li>
<li>Thus part of the information (variance) of one PC is shared with part of the information of another PCs (i.e. non-zero correlation or covariance).</li>
</ul></li>
</ul>
</div>
<div id="loading" class="section level2">
<h2><span class="header-section-number">3.2</span> Loading</h2>
<p>Loadings of the first two PCs, with constraint <span class="math inline">\(\Vert\mathbf{v}\Vert_1 &lt; 5\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>k &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>Vk &lt;-<span class="st"> </span>spcX<span class="op">$</span>v[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">colnames</span>(Vk) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;V&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">grid.arrange</span>(</span>
<span id="cb12-6"><a href="#cb12-6"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V1)) <span class="op">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) ,</span>
<span id="cb12-12"><a href="#cb12-12"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V2)) <span class="op">+</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb12-18"><a href="#cb12-18"></a>  <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>These plots show the loadings of the first two sparse PCs. Many of the loadings are now exactly equal to zero. Only few genes show large loadings.</p>
</div>
<div id="change-constraint" class="section level2">
<h2><span class="header-section-number">3.3</span> Change constraint</h2>
<p>We now repeat the analysis, but with the constraint <span class="math inline">\(\Vert \mathbf{v} \Vert_1 &lt; 1\)</span>. This gives a much sparser solution with only two genes with non-zero loadings in each dimension.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>spcX1 &lt;-<span class="st"> </span><span class="kw">SPC</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  toxData[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">    </span>as.matrix,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="dt">K=</span><span class="dv">30</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="dt">sumabsv =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12
## 12</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>k &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>Vk &lt;-<span class="st"> </span>spcX1<span class="op">$</span>v[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw">colnames</span>(Vk) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">grid.arrange</span>(</span>
<span id="cb15-6"><a href="#cb15-6"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V1)) <span class="op">+</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) ,</span>
<span id="cb15-12"><a href="#cb15-12"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V2)) <span class="op">+</span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb15-18"><a href="#cb15-18"></a>  <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<hr />
<p>We now repeat the analysis, but with the constraint <span class="math inline">\(\Vert \mathbf{v} \Vert_1 &lt; 10\)</span>. This gives a much less sparse solution with several genes with non-zero loadings.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>spcX10 &lt;-<span class="st"> </span><span class="kw">SPC</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  toxData[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="st">    </span>as.matrix,</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="dt">K=</span><span class="dv">30</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="dt">sumabsv =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920
## 1234567891011121314151617181920</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>k &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>Vk &lt;-<span class="st"> </span>spcX10<span class="op">$</span>v[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">colnames</span>(Vk) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;V&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="kw">grid.arrange</span>(</span>
<span id="cb18-6"><a href="#cb18-6"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V1)) <span class="op">+</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) ,</span>
<span id="cb18-12"><a href="#cb18-12"></a>  Vk <span class="op">%&gt;%</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">geneID =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Vk)) <span class="op">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> geneID, <span class="dt">y =</span> V2)) <span class="op">+</span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">pch=</span><span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="op">*</span><span class="kw">sd</span>(Vk[,<span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb18-18"><a href="#cb18-18"></a>  <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<hr />
</div>
<div id="variance-explained" class="section level2">
<h2><span class="header-section-number">3.4</span> Variance explained</h2>
<p>Variance explained for <span class="math inline">\(c=1,5,10\)</span> and <span class="math inline">\(+\infty\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">data.frame</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="dt">PCs =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="st">&quot;c1&quot;</span> =<span class="st"> </span>spcX1<span class="op">$</span>prop.var.explained,</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="st">&quot;c5&quot;</span> =<span class="st"> </span>spcX<span class="op">$</span>prop.var.explained,</span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="st">&quot;c10&quot;</span> =<span class="st"> </span>spcX10<span class="op">$</span>prop.var.explained,</span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="st">&quot;conventional&quot;</span> =<span class="st"> </span><span class="kw">cumsum</span>(svdX<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="kw">sum</span>(svdX<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;method&quot;</span>,<span class="st">&quot;varExpl&quot;</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PCs, <span class="dt">y =</span> varExpl, <span class="dt">color =</span> method)) <span class="op">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Variance explained (%)&quot;</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>This graph illustrates that the percentages of variance explained by the PCs are smaller for sparser solutions. Thus in choosing an appropriate penalty parameter <span class="math inline">\(c_2\)</span> one should not only look at the sparseness of the solution, but also at the percentage of variance contained in the first few PCs. If this percentage is very small, then the graphs of the scores (or biplots) are no longer very informative (i.e. they will not tell the full story). Thus a compromise must be looked for.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">library</span>(latex2exp)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>Uk5 &lt;-<span class="st"> </span>spcX<span class="op">$</span>u[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb20-4"><a href="#cb20-4"></a>Dk5 &lt;-<span class="st"> </span><span class="kw">diag</span>(spcX<span class="op">$</span>d[<span class="dv">1</span><span class="op">:</span>k])</span>
<span id="cb20-5"><a href="#cb20-5"></a>Zk5 &lt;-<span class="st"> </span>Uk5<span class="op">%*%</span>Dk5</span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="kw">colnames</span>(Zk5) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Z&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a>spc5 &lt;-<span class="st"> </span>Zk5 <span class="op">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BA =</span> toxData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(BA)) <span class="op">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> Z1, <span class="dt">y =</span> Z2, <span class="dt">color =</span> BA)) <span class="op">+</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="st">  </span><span class="kw">scale_colour_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">mid=</span><span class="st">&quot;white&quot;</span>,<span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">TeX</span>(<span class="st">&quot;$c_2 = 5$&quot;</span>))</span>
<span id="cb20-16"><a href="#cb20-16"></a></span>
<span id="cb20-17"><a href="#cb20-17"></a>Uk1 &lt;-<span class="st"> </span>spcX1<span class="op">$</span>u[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb20-18"><a href="#cb20-18"></a>Dk1 &lt;-<span class="st"> </span><span class="kw">diag</span>(spcX1<span class="op">$</span>d[<span class="dv">1</span><span class="op">:</span>k])</span>
<span id="cb20-19"><a href="#cb20-19"></a>Zk1 &lt;-<span class="st"> </span>Uk1<span class="op">%*%</span>Dk1</span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="kw">colnames</span>(Zk1) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Z&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb20-21"><a href="#cb20-21"></a></span>
<span id="cb20-22"><a href="#cb20-22"></a>spc1 &lt;-<span class="st"> </span>Zk1 <span class="op">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BA =</span> toxData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(BA)) <span class="op">%&gt;%</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> Z1, <span class="dt">y =</span> Z2, <span class="dt">color =</span> BA)) <span class="op">+</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="st">  </span><span class="kw">scale_colour_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">mid=</span><span class="st">&quot;white&quot;</span>,<span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">TeX</span>(<span class="st">&quot;$c_2 = 1$&quot;</span>))</span>
<span id="cb20-30"><a href="#cb20-30"></a></span>
<span id="cb20-31"><a href="#cb20-31"></a>Uk10 &lt;-<span class="st"> </span>spcX10<span class="op">$</span>u[,<span class="dv">1</span><span class="op">:</span>k]</span>
<span id="cb20-32"><a href="#cb20-32"></a>Dk10 &lt;-<span class="st"> </span><span class="kw">diag</span>(spcX10<span class="op">$</span>d[<span class="dv">1</span><span class="op">:</span>k])</span>
<span id="cb20-33"><a href="#cb20-33"></a>Zk10 &lt;-<span class="st"> </span>Uk10<span class="op">%*%</span>Dk10</span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="kw">colnames</span>(Zk10) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Z&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb20-35"><a href="#cb20-35"></a></span>
<span id="cb20-36"><a href="#cb20-36"></a>spc10 &lt;-<span class="st"> </span>Zk10 <span class="op">%&gt;%</span></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BA =</span> toxData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(BA)) <span class="op">%&gt;%</span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> Z1, <span class="dt">y =</span> Z2, <span class="dt">color =</span> BA)) <span class="op">+</span></span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="st">  </span><span class="kw">scale_colour_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">mid=</span><span class="st">&quot;white&quot;</span>,<span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-42"><a href="#cb20-42"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">TeX</span>(<span class="st">&quot;$c_2 = 10$&quot;</span>))</span>
<span id="cb20-44"><a href="#cb20-44"></a></span>
<span id="cb20-45"><a href="#cb20-45"></a><span class="kw">grid.arrange</span>(spc1, spc5, spc10, pca <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">TeX</span>(<span class="st">&quot;$c_2 = </span><span class="ch">\\</span><span class="st">infty&quot;</span>)), <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="sparseSvd_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Finally we show the plots of the scores on the first two sparse PCs for <span class="math inline">\(c_2=1\)</span> (top-left), <span class="math inline">\(c_2=5\)</span> (top-right) and <span class="math inline">\(c_2=10\)</span> (bottom-left) and <span class="math inline">\(c_2=\infty\)</span> (bottom-right, convention SVD).</p>
<p>Note, that the most sparse solution (top-left) shows a strong positive correlation between the first two PCs (as a consequence of the loss of orthogonality of the singular vectors).</p>
<p>All graphs succeed quite well in separating the toxic from the non-toxic compounds based on their gene expression.</p>
<ul>
<li><p>Hence, we may expect that the two genes identified from the most sparse solution play an important role in the development of toxic effects.</p></li>
<li><p>Note, however, that our data analysis did not provide a scientific proof for this conclusion: (sparse) PCA is only an exploratory or descriptive data analysis method that helps the data-analyst to gain insight into the data.</p></li>
<li><p>The fact that we found a few genes that appear to be associated with toxicity is of course a nice result.</p></li>
<li><p>It is important to understand that the toxicity outcome was not used in the (sparse) PCA. We only used the toxicity to color the points in the graphs. PCA is an unsupervised method.</p></li>
</ul>
</div>
</div>
<div id="acknowledgement" class="section level1 unnumbered">
<h1>Acknowledgement</h1>
<ul>
<li>Olivier Thas for sharing his materials of Analysis of High Dimensional Data 2019-2020, which I used as the starting point for this chapter.</li>
</ul>
</div>
<div id="session-info" class="section level1 unnumbered">
<h1>Session info</h1>
<details>
<p><summary>Session info</summary></p>
<pre><code>## [1] &quot;2021-05-11 14:44:38 UTC&quot;</code></pre>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 4.0.5 (2021-03-31)
##  os       macOS Catalina 10.15.7      
##  system   x86_64, darwin17.0          
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       UTC                         
##  date     2021-05-11                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package                * version    date       lib
##  AIMS                   * 1.22.0     2020-10-27 [1]
##  amap                     0.8-18     2019-12-12 [1]
##  AnnotationDbi            1.52.0     2020-10-27 [1]
##  AnnotationHub          * 2.22.1     2021-04-16 [1]
##  askpass                  1.1        2019-01-13 [1]
##  assertthat               0.2.1      2019-03-21 [1]
##  backports                1.2.1      2020-12-09 [1]
##  beachmat                 2.6.4      2020-12-20 [1]
##  beeswarm                 0.3.1      2021-03-07 [1]
##  Biobase                * 2.50.0     2020-10-27 [1]
##  BiocFileCache          * 1.14.0     2020-10-27 [1]
##  BiocGenerics           * 0.36.1     2021-04-16 [1]
##  BiocManager              1.30.15    2021-05-11 [1]
##  BiocNeighbors            1.8.2      2020-12-07 [1]
##  BiocParallel             1.24.1     2020-11-06 [1]
##  BiocSingular             1.6.0      2020-10-27 [1]
##  BiocVersion              3.12.0     2020-05-14 [1]
##  biomaRt                * 2.46.3     2021-02-11 [1]
##  bit                      4.0.4      2020-08-04 [1]
##  bit64                    4.0.5      2020-08-30 [1]
##  bitops                   1.0-7      2021-04-24 [1]
##  blob                     1.2.1      2020-01-20 [1]
##  boot                   * 1.3-28     2021-05-03 [1]
##  bootstrap                2019.6     2019-06-17 [1]
##  breastCancerMAINZ      * 1.28.0     2020-10-29 [1]
##  broom                    0.7.6      2021-04-05 [1]
##  bslib                    0.2.4      2021-01-25 [1]
##  cachem                   1.0.4      2021-02-13 [1]
##  callr                    3.7.0      2021-04-20 [1]
##  CCA                    * 1.2.1      2021-03-01 [1]
##  cellranger               1.1.0      2016-07-27 [1]
##  class                    7.3-18     2021-01-24 [2]
##  cli                      2.5.0      2021-04-26 [1]
##  cluster                * 2.1.2      2021-04-17 [1]
##  codetools                0.2-18     2020-11-04 [2]
##  colorspace               2.0-1      2021-05-04 [1]
##  crayon                   1.4.1      2021-02-08 [1]
##  curl                     4.3.1      2021-04-30 [1]
##  DAAG                   * 1.24       2020-03-10 [1]
##  DBI                      1.1.1      2021-01-15 [1]
##  dbplyr                 * 2.1.1      2021-04-06 [1]
##  DelayedArray             0.16.3     2021-03-24 [1]
##  DelayedMatrixStats       1.12.3     2021-02-03 [1]
##  desc                     1.3.0      2021-03-05 [1]
##  devtools                 2.4.1      2021-05-05 [1]
##  digest                   0.6.27     2020-10-24 [1]
##  dotCall64              * 1.0-1      2021-02-11 [1]
##  dplyr                  * 1.0.6      2021-05-05 [1]
##  e1071                  * 1.7-6      2021-03-18 [1]
##  elasticnet               1.3        2020-05-15 [1]
##  ellipsis                 0.3.2      2021-04-29 [1]
##  evaluate                 0.14       2019-05-28 [1]
##  ExperimentHub          * 1.16.1     2021-04-16 [1]
##  fansi                    0.4.2      2021-01-15 [1]
##  farver                   2.1.0      2021-02-28 [1]
##  fastmap                  1.1.0      2021-01-25 [1]
##  fda                    * 5.1.9      2020-12-16 [1]
##  fds                    * 1.8        2018-10-31 [1]
##  fields                 * 11.6       2020-10-09 [1]
##  forcats                * 0.5.1      2021-01-27 [1]
##  foreach                  1.5.1      2020-10-15 [1]
##  fs                       1.5.0      2020-07-31 [1]
##  genefu                 * 2.22.1     2021-01-26 [1]
##  generics                 0.1.0      2020-10-31 [1]
##  GenomeInfoDb           * 1.26.7     2021-04-08 [1]
##  GenomeInfoDbData         1.2.4      2021-05-11 [1]
##  GenomicRanges          * 1.42.0     2020-10-27 [1]
##  gganimate              * 1.0.7      2020-10-15 [1]
##  ggbeeswarm               0.6.0      2017-08-07 [1]
##  ggbiplot               * 0.55       2021-05-11 [1]
##  ggforce                * 0.3.3      2021-03-05 [1]
##  ggplot2                * 3.3.3      2020-12-30 [1]
##  GIGrvg                   0.5        2017-06-10 [1]
##  git2r                    0.28.0     2021-01-10 [1]
##  glmnet                 * 4.1-1      2021-02-21 [1]
##  glue                     1.4.2      2020-08-27 [1]
##  gridExtra              * 2.3        2017-09-09 [1]
##  gtable                   0.3.0      2019-03-25 [1]
##  haven                    2.4.1      2021-04-23 [1]
##  hdrcde                   3.4        2021-01-18 [1]
##  highr                    0.9        2021-04-16 [1]
##  hms                      1.0.0      2021-01-13 [1]
##  htmltools                0.5.1.1    2021-01-22 [1]
##  httpuv                   1.6.1      2021-05-07 [1]
##  httr                     1.4.2      2020-07-20 [1]
##  HyperbolicDist           0.6-2      2009-09-23 [1]
##  iC10                   * 1.5        2019-02-08 [1]
##  iC10TrainingData       * 1.3.1      2018-08-24 [1]
##  impute                 * 1.64.0     2020-10-27 [1]
##  interactiveDisplayBase   1.28.0     2020-10-27 [1]
##  IRanges                * 2.24.1     2020-12-12 [1]
##  irlba                    2.3.3      2019-02-05 [1]
##  iterators                1.0.13     2020-10-15 [1]
##  jpeg                     0.1-8.1    2019-10-24 [1]
##  jquerylib                0.1.4      2021-04-26 [1]
##  jsonlite                 1.7.2      2020-12-09 [1]
##  KernSmooth               2.23-18    2020-10-29 [2]
##  knitr                    1.33       2021-04-24 [1]
##  ks                       1.12.0     2021-02-07 [1]
##  labeling                 0.4.2      2020-10-20 [1]
##  lars                     1.2        2013-04-24 [1]
##  later                    1.2.0      2021-04-23 [1]
##  latex2exp              * 0.5.0      2021-03-18 [1]
##  lattice                * 0.20-41    2020-04-02 [2]
##  latticeExtra             0.6-29     2019-12-19 [1]
##  lava                     1.6.9      2021-03-11 [1]
##  lifecycle                1.0.0      2021-02-15 [1]
##  limma                  * 3.46.0     2020-10-27 [1]
##  locfdr                 * 1.1-8      2015-07-15 [1]
##  lubridate                1.7.10     2021-02-26 [1]
##  magick                   2.7.2      2021-05-02 [1]
##  magrittr                 2.0.1      2020-11-17 [1]
##  maps                     3.3.0      2018-04-03 [1]
##  MASS                   * 7.3-53.1   2021-02-12 [2]
##  Matrix                 * 1.3-2      2021-01-06 [2]
##  MatrixGenerics         * 1.2.1      2021-01-30 [1]
##  matrixStats            * 0.58.0     2021-01-29 [1]
##  mclust                 * 5.4.7      2020-11-20 [1]
##  mda                      0.5-2      2020-06-29 [1]
##  memoise                  2.0.0      2021-01-26 [1]
##  mgcv                   * 1.8-35     2021-04-18 [1]
##  mime                     0.10       2021-02-13 [1]
##  misc3d                   0.9-0      2020-09-06 [1]
##  modelr                   0.1.8      2020-05-19 [1]
##  munsell                  0.5.0      2018-06-12 [1]
##  muscData               * 1.4.0      2020-10-29 [1]
##  mvtnorm                  1.1-1      2020-06-09 [1]
##  nlme                   * 3.1-152    2021-02-04 [2]
##  NormalBetaPrime        * 2.2        2019-01-19 [1]
##  openssl                  1.4.4      2021-04-30 [1]
##  pamr                   * 1.56.1     2019-04-22 [1]
##  pcaPP                  * 1.9-74     2021-04-23 [1]
##  pillar                   1.6.0      2021-04-13 [1]
##  pkgbuild                 1.2.0      2020-12-15 [1]
##  pkgconfig                2.0.3      2019-09-22 [1]
##  pkgload                  1.2.1      2021-04-06 [1]
##  plot3D                 * 1.3        2019-12-18 [1]
##  plotROC                * 2.2.1      2018-06-23 [1]
##  pls                    * 2.7-3      2020-08-07 [1]
##  plyr                   * 1.8.6      2020-03-03 [1]
##  PMA                    * 1.2.1      2020-02-03 [1]
##  png                      0.1-7      2013-12-03 [1]
##  polyclip                 1.10-0     2019-03-14 [1]
##  pracma                   2.3.3      2021-01-23 [1]
##  prettyunits              1.1.1      2020-01-24 [1]
##  processx                 3.5.2      2021-04-30 [1]
##  prodlim                * 2019.11.13 2019-11-17 [1]
##  progress                 1.2.2      2019-05-16 [1]
##  promises                 1.2.0.1    2021-02-11 [1]
##  proxy                    0.4-25     2021-03-05 [1]
##  ps                       1.6.0      2021-02-28 [1]
##  pscl                     1.5.5      2020-03-07 [1]
##  purrr                  * 0.3.4      2020-04-17 [1]
##  R6                       2.5.0      2020-10-28 [1]
##  rainbow                * 3.6        2019-01-29 [1]
##  rappdirs                 0.3.3      2021-01-31 [1]
##  RColorBrewer             1.1-2      2014-12-07 [1]
##  Rcpp                     1.0.6      2021-01-15 [1]
##  RCurl                  * 1.98-1.3   2021-03-16 [1]
##  readr                  * 1.4.0      2020-10-05 [1]
##  readxl                   1.3.1      2019-03-13 [1]
##  remotes                  2.3.0      2021-04-01 [1]
##  reprex                   2.0.0      2021-04-02 [1]
##  rlang                    0.4.11     2021-04-30 [1]
##  rmarkdown                2.8        2021-05-07 [1]
##  rmeta                    3.0        2018-03-20 [1]
##  rprojroot                2.0.2      2020-11-15 [1]
##  RSQLite                  2.2.7      2021-04-22 [1]
##  rstudioapi               0.13       2020-11-12 [1]
##  rsvd                     1.0.5      2021-04-16 [1]
##  rvest                    1.0.0      2021-03-09 [1]
##  S4Vectors              * 0.28.1     2020-12-09 [1]
##  sass                     0.3.1      2021-01-24 [1]
##  scales                 * 1.1.1      2020-05-11 [1]
##  scater                 * 1.18.6     2021-02-26 [1]
##  scuttle                  1.0.4      2020-12-17 [1]
##  SemiPar                * 1.0-4.2    2018-04-16 [1]
##  sessioninfo              1.1.1      2018-11-05 [1]
##  shape                    1.4.5      2020-09-13 [1]
##  shiny                    1.6.0      2021-01-25 [1]
##  SingleCellExperiment   * 1.12.0     2020-10-27 [1]
##  spam                   * 2.6-0      2020-12-14 [1]
##  sparseLDA              * 0.1-9      2016-09-22 [1]
##  sparseMatrixStats        1.2.1      2021-02-02 [1]
##  stringi                  1.6.1      2021-05-10 [1]
##  stringr                * 1.4.0      2019-02-10 [1]
##  SummarizedExperiment   * 1.20.0     2020-10-27 [1]
##  SuppDists                1.1-9.5    2020-01-18 [1]
##  survcomp               * 1.40.0     2020-10-27 [1]
##  survival               * 3.2-10     2021-03-16 [2]
##  survivalROC              1.0.3      2013-01-13 [1]
##  testthat                 3.0.2      2021-02-14 [1]
##  tibble                 * 3.1.1      2021-04-18 [1]
##  tidyr                  * 1.1.3      2021-03-03 [1]
##  tidyselect               1.1.1      2021-04-30 [1]
##  tidyverse              * 1.3.1      2021-04-15 [1]
##  tinytex                  0.31       2021-03-30 [1]
##  truncnorm                1.0-8      2018-02-27 [1]
##  tweenr                   1.0.2      2021-03-23 [1]
##  usethis                  2.0.1      2021-02-10 [1]
##  utf8                     1.2.1      2021-03-12 [1]
##  vctrs                    0.3.8      2021-04-29 [1]
##  vipor                    0.4.5      2017-03-22 [1]
##  viridis                  0.6.1      2021-05-11 [1]
##  viridisLite              0.4.0      2021-04-13 [1]
##  withr                    2.4.2      2021-04-18 [1]
##  xfun                     0.22       2021-03-11 [1]
##  XML                      3.99-0.6   2021-03-16 [1]
##  xml2                     1.3.2      2020-04-23 [1]
##  xtable                   1.8-4      2019-04-21 [1]
##  XVector                  0.30.0     2020-10-28 [1]
##  yaml                     2.2.1      2020-02-01 [1]
##  zlibbioc                 1.36.0     2020-10-28 [1]
##  source                       
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.5)               
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.1)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Github (vqv/ggbiplot@7325e88)
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.5)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.5)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  CRAN (R 4.0.2)               
##  Bioconductor                 
##  CRAN (R 4.0.2)               
##  Bioconductor                 
## 
## [1] /Users/runner/work/_temp/Library
## [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</code></pre>
</details>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiNC4gU3BhcnNlIFNpbmd1bGFyIFZhbHVlIERlY29tcG9zaXRpb24iCmF1dGhvcjogIkxpZXZlbiBDbGVtZW50IgpkYXRlOiAic3RhdE9taWNzLCBHaGVudCBVbml2ZXJzaXR5IChodHRwczovL3N0YXRvbWljcy5naXRodWIuaW8pIgpvdXRwdXQ6CiAgICBodG1sX2RvY3VtZW50OgogICAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCiAgICAgIHRoZW1lOiBjb3NtbwogICAgICB0b2M6IHRydWUKICAgICAgdG9jX2Zsb2F0OiB0cnVlCiAgICAgIGhpZ2hsaWdodDogdGFuZ28KICAgICAgbnVtYmVyX3NlY3Rpb25zOiB0cnVlCiAgICBwZGZfZG9jdW1lbnQ6CiAgICAgIHRvYzogdHJ1ZQogICAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKLS0tCgpgYGB7ciBlY2hvID0gRkFMU0UsIHdhcm5pbmcgPSBGQUxTRX0KbGlicmFyeSh0aWR5dmVyc2UpCmxpYnJhcnkoZ3JpZEV4dHJhKQpgYGAKCiMgSW50cm9kdWN0aW9uCgpJbiBoaWdoIGRpbWVuc2lvbmFsIGRhdGEgdGhlIFBDcyBtYXkgaGF2ZSB1bmNsZWFyIGludGVycHJldGF0aW9uIGJlY2F1c2UgdGhleSBkZXBlbmQgb24gYWxsICRwJCBvcmlnaW5hbCB2YXJpYWJsZXMuCgojIyBFeGFtcGxlOiBUb3hpY29nZW5vbWljcyBpbiBlYXJseSBkcnVnIGRldmVsb3BtZW50CgojIyMgQmFja2dyb3VuZAoKLSBFZmZlY3Qgb2YgY29tcG91bmQgb24gZ2VuZSBleHByZXNzaW9uLgoKLSBJbnNpZ2h0IGluIGFjdGlvbiBhbmQgdG94aWNpdHkgb2YgZHJ1ZyBpbiBlYXJseSBwaGFzZQotIERldGVybWluZSBhY3Rpdml0eSB3aXRoIGJpby1hc3NheTogZS5nLiBiaW5kaW5nIGFmaW5pdHkgb2YgY29tcG91bmQgdG8gY2VsbHdhbGwgcmVjZXB0ZXIgKHRhcmdldCwgSUM1MCkuCi0gRWFybHkgcGhhc2U6ICAyMCB0byA1MCBjb21wb3VuZHMKLSBCYXNlZCBvbiBpbiB2aXRybyByZXN1bHRzIG9uZSBhaW1zIHRvIGdldCBpbnNpZ2h0IGluIGhvdyB0byBidWlsZCBiZXR0ZXIgY29tcG91bmQgKGhpZ2hlciBvbi10YXJnZXQgYWN0aXZpdHkgbGVzcyB0b3hpY2l0eS4KLSBTbWFsbCB2YXJpYW50aW9ucyBpbiBtb2VsY3VsYWlyIHN0cnVjdHVyZSBsZWFkIHRvIHZhcmlhdGlvbnMgaW4gQkEgYW5kIGdlbmUgZXhwcmVzc2lvbi4KLSBBaW06IEJ1aWxkIG1vZGVsIHRvIHByZWRpY3QgYmlvLWFjdGl2aXR5IGJhc2VkIG9uIGdlbmUgZXhwcmVzc2lvbiBpbiBsaXZlciBjZWxsIGxpbmUuCgojIyMgRGF0YQoKLSAzMCBjaGVtaWNhbCBjb21wb3VuZHMgaGF2ZSBiZWVuIHNjcmVlbmVkIGZvciB0b3hpY2l0eQoKLSBCaW9hc3NheSBkYXRhIG9uIHRveGljaXR5IHNjcmVlbmluZwoKLSBHZW5lIGV4cHJlc3Npb25zIGluIGEgbGl2ZXIgY2VsbCBsaW5lIGFyZSBwcm9maWxlZCBmb3IgZWFjaCBjb21wb3VuZCAoNDAwMCBnZW5lcykKCgpgYGB7cn0KdG94RGF0YSA8LSByZWFkX2NzdigKICAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3N0YXRPbWljcy9IREEyMDIwL2RhdGEvdG94RGF0YUNlbnRlcmVkLmNzdiIsCiAgY29sX3R5cGVzID0gY29scygpCikKc3ZkWCA8LSBzdmQodG94RGF0YVssLTFdKQpgYGAKCkRhdGEgaXMgYWxyZWFkeSBjZW50ZXJlZDoKCmBgYHtyfQp0b3hEYXRhICU+JQogIGNvbE1lYW5zICU+JQogIHJhbmdlCmBgYAoKYGBge3J9CiB0b3hEYXRhICU+JQogIG5hbWVzICU+JQogIGhlYWQKYGBgCgotIEZpcnN0IGNvbHVtbiBjb250YWlucyBkYXRhIG9uIEJpb2Fzc2F5LgotIFRoZSBoaWdoZXIgdGhlIHNjb3JlIG9uIEJpb2Fzc2F5IHRoZSBtb3JlIHRveGljIHRoZSBjb21wb3VuZAotIE90aGVyIGNvbHVtbnMgY29udGFpbiBkYXRhIG9uIGdlbmUgZXhwcmVzc2lvbiBYMSwgLi4uICwgWDQwMDAKCiMjIyBEYXRhIGV4cGxvcmF0aW9uCgpgYGB7cn0KdG94RGF0YSAlPiUKICBnZ3Bsb3QoYWVzKHg9IiIseT1CQSkpICsKICBnZW9tX2JveHBsb3Qob3V0bGllci5zaGFwZT1OQSkgKwogIGdlb21fcG9pbnQocG9zaXRpb249ImppdHRlciIpCmBgYAoKYGBge3J9CnN2ZFggPC0gdG94RGF0YVssLTFdICU+JQogIHN2ZAoKayA8LSAyClZrIDwtIHN2ZFgkdlssMTprXQpVayA8LSBzdmRYJHVbLDE6a10KRGsgPC0gZGlhZyhzdmRYJGRbMTprXSkKWmsgPC0gVWslKiVEawpjb2xuYW1lcyhaaykgPC0gcGFzdGUwKCJaIiwxOmspCmNvbG5hbWVzKFZrKSA8LSBwYXN0ZTAoIlYiLDE6aykKCnBjYSA8LSBaayAlPiUKICBhcy5kYXRhLmZyYW1lICU+JQogIG11dGF0ZShCQSA9IHRveERhdGEgJT4lIHB1bGwoQkEpKSAlPiUKICBnZ3Bsb3QoYWVzKHg9IFoxLCB5ID0gWjIsIGNvbG9yID0gQkEpKSArCiAgZ2VvbV9wb2ludChzaXplID0gMykgKwogIHNjYWxlX2NvbG91cl9ncmFkaWVudDIobG93ID0gImJsdWUiLG1pZD0id2hpdGUiLGhpZ2g9InJlZCIpICsKICBnZW9tX3BvaW50KHNpemUgPSAzLCBwY2ggPSAyMSwgY29sb3IgPSAiYmxhY2siKQpwY2EKYGBgCgotIFNjb3JlcyBvbiB0aGUgZmlyc3QgdHdvIHByaW5jaXBhbCBjb21wb25lbnRzIChvciBNRFMgcGxvdCkuIC0gRWFjaCBwb2ludCBjb3JyZXNwb25kcyB0byBhIGNvbXBvdW5kLgotIENvbG9yIGNvZGUgcmVmZXJzIHRvIHRoZSB0b3hpY2l0eSBzY29yZSAoaGlnaGVyIHNjb3JlIG1vcmUgdG94aWMpLgotIENsZWFyIHNlcGFyYXRpb24gYmV0d2VlbiBjb21wb3VuZHMgYWNjb3JkaW5nIHRvIHRveGljaXR5LgoKLS0tCgotIE5leHQgbG9naWMgc3RlcCBpbiBhIFBDQSBpcyB0byBpbnRlcnByZXQgdGhlIHByaW5jaXBhbCBjb21wb25lbnRzLgotIFdlIHRodXMgaGF2ZSB0byBhc3Nlc3MgdGhlIGxvYWRpbmdzLgotIFdlIGNhbiBhZGQgYSB2ZWN0b3IgZm9yIGVhY2ggZ2VuZSB0byBnZXQgYSBiaXBsb3QsIGJ1dCB0aGlzIHdvdWxkIHJlcXVpcmUgcGxvdHRpbmcgNDAwMCB2ZWN0b3JzLCB3aGljaCB3b3VsZCByZW5kZXIgdGhlIHBsb3QgdW5yZWFkYWJsZS4KCkFsdGVybmF0aXZlIGdyYXBoIHRvIGxvb2sgYXQgdGhlIG1hbnkgbG9hZGluZ3Mgb2YgdGhlIGZpcnN0IHR3byBQQ3MuCgpgYGB7cn0KZ3JpZC5hcnJhbmdlKAogIFZrICU+JQogICAgYXMuZGF0YS5mcmFtZSAlPiUKICAgIG11dGF0ZShnZW5lSUQgPSAxOm5yb3coVmspKSAlPiUKICAgIGdncGxvdChhZXMoeCA9IGdlbmVJRCwgeSA9IFYxKSkgKwogICAgZ2VvbV9wb2ludChwY2g9MjEpICsKICAgIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTIsMCwyKSpzZChWa1ssMV0pLCBjb2wgPSAicmVkIikgLAogIFZrICU+JQogICAgYXMuZGF0YS5mcmFtZSAlPiUKICAgIG11dGF0ZShnZW5lSUQgPSAxOm5yb3coVmspKSAlPiUKICAgIGdncGxvdChhZXMoeCA9IGdlbmVJRCwgeSA9IFYyKSkgKwogICAgZ2VvbV9wb2ludChwY2g9MjEpICsKICAgIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTIsMCwyKSpzZChWa1ssMl0pLCBjb2wgPSAicmVkIiksCiAgbmNvbD0yKQpgYGAKCi0gSXQgaXMgYWxtb3N0IGltcG9zc2libGUgdG8gaW50ZXJwcmV0IHRoZSBQQ3MgYmVjYXVzZSB0aGVyZSBhcmUgNDAwMCBnZW5lcyBjb250cmlidXRpbmcgdG8gZWFjaCBQQy4KCi0gSW4gYW4gYXR0ZW1wdCB0byBmaW5kIHRoZSBtb3N0IGltcG9ydGFudCBnZW5lcyAoaW4gdGhlIHNlbnNlIHRoYXQgdGhleSBkcml2ZSB0aGUgaW50ZXJwcmV0YXRpb24gb2YgdGhlIFBDcyksIHRoZSBwbG90cyBzaG93IGhvcml6b250YWwgcmVmZXJlbmNlIGxpbmVzOiB0aGUgYXZlcmFnZSBvZiB0aGUgbG9hZGluZ3MsIGFuZCB0aGUgYXZlcmFnZSDCsSB0d2ljZSB0aGUgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIHRoZSBsb2FkaW5ncy4gSW4gYmV0d2VlbiB0aGUgbGluZXMgd2UgZXhwZWN0cyBhYm91dCA5NSUgb2YgdGhlIGxvYWRpbmdzIChpZiB0aGV5IHdlcmUgbm9ybWFsbHkgZGlzdHJpYnV0ZWQpLgoKLSBUaGUgcG9pbnRzIG91dHNpZGUgdGhlIGJhbmQgY29tZSBmcm9tIHRoZSBnZW5lcyB0aGF0IGhhdmUgcmF0aGVyIGxhcmdlIGxvYWRpbmdzIChpbiBhYnNvbHV0ZSB2YWx1ZSkgYW5kIGhlbmNlIGFyZSBpbXBvcnRhbnQgZm9yIHRoZSBpbnRlcnByZXRhdGlvbiBvZiB0aGUgUENzLgoKLSBOb3RlLCB0aGF0IHBhcnRpY3VsYXJseSBmb3IgdGhlIGZpcnN0IFBDLCBvbmx5IGEgZmV3IGdlbmVzIHNob3cgYSBtYXJrZWRseSBsYXJnZSBsb2FkaW5ncyB0aGF0IGFyZSBuZWdhdGl2ZS4gVGhpcyBtZWFucyB0aGF0IGFuIHVwcmVndWxhdGlvbiBvZiB0aGVzZSBnZW5lcyB3aWxsIGxlYWQgdG8gbG93IHNjb3JlcyBvbiBQQzEuCi0gVGhlc2UgZ2VuZXMgd2lsbCB2ZXJ5IGxpa2VseSBwbGF5IGFuIGltcG9ydGFudCByb2xlIGluIHRoZSB0b3hpY2l0eSBtZWNoYW5pc20uCi0gSW5kZWVkLCBsb3cgc2NvcmVzIG9uIFBDMSBhcmUgaW4gdGhlIGRpcmVjdGlvbiBvZiBtb3JlIHRveGljaXR5LgoKLS0tCgojIyBTcGFyc2UgbWF0cml4IGRlY29tcG9zaXRpb24KCkJhc2ljIGlkZWEgb2Ygc3BhcnNlIG1hdHJpeCBkZWNvbXBvc2l0aW9uIG9mIGFuICRuIFx0aW1lcyBwJCBtYXRyaXggJFxtYXRoYmZ7WH0kfQoKRmluZCBhIHJhbmsgJGskIGFwcHJveGltYXRpb24gb2YgJFxtYXRoYmZ7WH0kIG9mIHRoZSBmb3JtClxbClxtYXRoYmZ7WH1fayA9IFxzdW1fe2o9MX1eayBcZGVsdGFfaiBcbWF0aGJme3V9X2pcbWF0aGJme3Z9X2pedApcXQpzdWNoIHRoYXQgbWFueSBvZiB0aGUgZWxlbWVudHMgaW4gdGhlICRcbWF0aGJme3Z9X2okIGFuZCBvciAkXG1hdGhiZnt1fV9qJCBhcmUgZXhhY3RseSB6ZXJvLgoKV2UgZm9jdXMgb24gdGhlICoqUGVuYWxpc2VkIE1hdHJpeCBEZWNvbXBvc2l0aW9uKiogKFBNRCkgbWV0aG9kIG9mIFdpdHRlbiAqZXQgYWwuKiAoMjAwOSwgQmlvc3RhdGlzdGljcywgMTAsIDMsIDUxNS01MzQpLgoKV2hlbiBtYW55IG9mIHRoZSBsb2FkaW5ncyBpbiAkXG1hdGhiZnt2fV9qJCBhcmUgemVybywgdGhlIGludGVycHJldGF0aW9uIG9mIHRoZSBQQyBvbmx5IGRlcGVuZHMgb24gdGhlIGZlYXR1cmVzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgcmVtYWluaW5nIG5vbi16ZXJvIGxvYWRpbmdzLgoKLS0tCgojIFBlbmFsaXNlZCBNYXRyaXggRGVjb21wb3NpdGlvbgoKIyMgUmFuayAxIGFwcHJveGltYXRpb24KClRoZSByYW5rLTEgUE1EIGFwcHJveGltYXRpb24gb2YgdGhlICRuIFx0aW1lcyBwJCBtYXRyaXggJFxtYXRoYmZ7WH0kIGlzIG9mIHRoZSBmb3JtClxbClxtYXRoYmZ7WH1fMSA9IFxkZWx0YV8xXG1hdGhiZnt1fV8xXG1hdGhiZnt2fV8xXnQsClxdCgphbmQgaXQgaXMgdGhlIHNvbHV0aW9uIHRvIHRoZSBmb2xsb3dpbmcgbWluaW1pc2F0aW9uIHByb2JsZW06ClxbClxtaW5fe1xkZWx0YSx1LHZ9IFxWZXJ0IFxtYXRoYmZ7WH0gLSBcZGVsdGFcbWF0aGJme3V9XG1hdGhiZnt2fV50XFZlcnRfRl4yIFx0ZXh0eyBzdWJqZWN0IHRvIH0KXGRlbHRhIFxnZXEgMCwgXFZlcnQgXG1hdGhiZnt1fVxWZXJ0XzJeMj1cVmVydCBcbWF0aGJme3Z9XFZlcnRfMl4yPTEsIFxWZXJ0XG1hdGhiZnt1fVxWZXJ0XzFcbGVxIGNfMSwgXFZlcnQgXG1hdGhiZnt2fVxWZXJ0XzEgXGxlcSBjXzIKXF0KCmZvciBzb21lIHVzZXItZGVmaW5lZCBjb25zdGFudHMgJGNfMSxjXzI+MCQuCgpUaGUgY29uc3RyYWludHMgJFxWZXJ0XG1hdGhiZnt1fVxWZXJ0XzFcbGVxIGNfMSQgYW5kICRcVmVydCBcbWF0aGJme3Z9XFZlcnRfMSBcbGVxIGNfMiQgYXJlIGtub3duIGFzICRMXzEkIG9yIGxhc3NvIGNvbnN0cmFpbnRzLgoKCk5vdGUsClxbClxWZXJ0XG1hdGhiZnt1fVxWZXJ0XzFcID0gXHN1bV97aT0xfV5uIFx2ZXJ0IHVfaSBcdmVydCBcdGV4dHsgYW5kIH1cVmVydFxtYXRoYmZ7dn1cVmVydF8xXCA9IFxzdW1fe2k9MX1ecCBcdmVydCB2X2lcdmVydC4KXF0KCklmICRjXzE9K1xpbmZ0eSQsIHRoZW4gdGhlIGNvbnN0cmFpbnQgb24gJFxtYXRoYmZ7dX0kIGlzIHJlbW92ZWQgKHNpbWlsYXIgZm9yICRjXzIkKS4KCi0tLQoKTm90ZSB0aGF0ClxbCiAgXG1pbl97XGRlbHRhLHUsdn0gXFZlcnQgXG1hdGhiZntYfSAtIFxkZWx0YVxtYXRoYmZ7dX1cbWF0aGJme3Z9XnRcVmVydF9GXjIgPSBcbWluX3tBOlx0ZXh0e3Jhbmt9KEEpPTF9ICBcVmVydCBcbWF0aGJme1h9IC0gQVxWZXJ0X0ZeMgpcXQp3aXRoICRBPVhfMSQgKHRydW5jYXRlZCBTVkQgb2YgJFxtYXRoYmZ7WH0kLCB0cnVuY2F0ZWQgYWZ0ZXIgMSB0ZXJtKS4gSG93ZXZlciwgdGhlIFBNRCByZXF1aXJlcyBhIGNvbnN0cmFpbmVkIG1pbmltaXNhdGlvbi4gVGhlIHVuY29uc3RyYWluZWQgc29sdXRpb24gYXJpc2VzIHdpdGggJGNfMT1jXzI9K1xpbmZ0eSQuCgpOb3RlIHRoYXQgJFxWZXJ0IFxtYXRoYmZ7dX1cVmVydF8yXjI9XFZlcnQgXG1hdGhiZnt2fVxWZXJ0XzJeMj0xJCBtYXkgYWxzbyBiZSB3cml0dGVuIGFzICRcbWF0aGJme3V9XnRcbWF0aGJme3V9PVxtYXRoYmZ7dn1edFxtYXRoYmZ7dn09MSQgKGkuZS4gdGhlIHZlY3RvcnMgYXJlIG5vcm1hbGlzZWQsIGp1c3QgbGlrZSBmb3IgdGhlIHNpbmd1bGFyIHZlY3RvcnMgb2YgdGhlIFNWRCkuCgotIFdlIGFsc28gYXBwbGllZCB0aGUgJExfMSQgY29uc3RyYWludCB0byB0aGUgbGVhc3Qtc3F1YXJlcyBlc3RpbWF0b3Igb2YgdGhlIHJlZ3Jlc3Npb24gcGFyYW1ldGVycyBpbiBhIGxpbmVhciByZWdyZXNzaW9uIG1vZGVsLgoKLSBFZmZlY3Qgd2FzIHRoYXQgbWFueSBvZiB0aGUgcGFyYW1ldGVyIGVzdGltYXRlcyBhcmUgc2V0IGV4YWN0bHkgdG8gemVyby4KCi0gSGVyZSwgdGhlIHNhbWUgZWZmZWN0IHdpbGwgdGFrZSBwbGFjZS4gTWFueSBvZiB0aGUgZWxlbWVudHMgaW4gJFxtYXRoYmZ7dX0kIGFuZCAkXG1hdGhiZnt2fSQgd2lsbCBiZSBzZXQgZXhhY3RseSB0byB6ZXJvLgoKLSBJbiBwYXJ0aWN1bGFyLCB0aGUgc21hbGxlciAkY18yJCwgdGhlIG1vcmUgZWxlbWVudHMgb2YgJFxtYXRoYmZ7dn0kIHdpbGwgYmUgc2V0IHRvIHplcm8gKHNocmlua2FnZSkuCgotIFNpbWlsYXJseSwgdGhlIHNtYWxsZXIgJGNfMSQsIHRoZSBtb3JlIGVsZW1lbnRzIG9mICRcbWF0aGJme3V9JCB3aWxsIGJlIHNldCB0byB6ZXJvLgoKLSBUaGUgY2hvaWNlIG9mICRjXzEkIGFuZCAkY18yJCBkZXBlbmRzIG9uIHRoZSBvYmplY3RpdmUgb2YgdGhlIGRhdGEgYW5hbHlzaXMgYW5kIHdpbGwgYmUgZGlzY3Vzc2VkIGxhdGVyLgoKVGhlIHNvbHV0aW9uIGlzIGtub3duIGFzIGEgcmFuay0xIFBNRCBhcHByb3hpbWF0aW9uIG9mICRcbWF0aGJme1h9JCBiZWNhdXNlICRcZGVsdGFfMVxtYXRoYmZ7dX1fMVxtYXRoYmZ7dn1fMV50JCBpcyBhIG1hdHJpeCBvZiByYW5rIDEuCgotLS0KCiMjIFJhbmstMiBhcHByb3hpbWF0aW9uCgpUaGUgcmFuay0yIFBNRCBhcHByb3hpbWF0aW9uIGlzIGZvdW5kIGFzIGZvbGxvd3M6CgoxLiBmaW5kIHRoZSByYW5rLTEgUE1EIGFzIGJlZm9yZTogJFxtYXRoYmZ7WH1fMT1cZGVsdGFfMVxtYXRoYmZ7dX1fMVxtYXRoYmZ7dn1fMV50JDsKCjIuIGNvbXB1dGUKXFsKXHRpbGRle1xtYXRoYmZ7WH19XzIgPSBcbWF0aGJme1h9LVxtYXRoYmZ7WH1fMSwKXF0KCmFuZCBjb21wdXRlIHRoZSByYW5rLTEgUE1EIG9mICRcdGlsZGV7XG1hdGhiZntYfX1fMiQsIHdoaWNoIGdpdmVzICRcZGVsdGFfMiwgXG1hdGhiZnt1fV8yLCBcbWF0aGJme3Z9XzIkOwoKMy4gdGhlIHJhbmstMiBQTUQgb2YgJFxtYXRoYmZ7WH0kIGlzIHRoZW4gZ2l2ZW4gYnkKXFsKXG1hdGhiZntYfV8yID0gXGRlbHRhXzFcbWF0aGJme3V9XzFcbWF0aGJme3Z9XzFedCtcZGVsdGFfMlxtYXRoYmZ7dX1fMlxtYXRoYmZ7dn1fMl50LgpcXQoKTm90ZSB0aGF0IHRoZSAkXG1hdGhiZnt1fSQncyBhbmQgJFxtYXRoYmZ7dn0kJ3MgYXJlIG5vdCBuZWNlc3NhcmlseSBvcnRob2dvbmFsIChvbmx5IGlmICRjXzEsIGNfMj0rXGluZnR5JCkuCgotLS0KCiMjIFJhbmstayBhcHByb3hpbWF0aW9uCgpUaGUgcmFuay0kayQgUE1EIGFwcHJveGltYXRpb24gaXMgZm91bmQgYXMgZm9sbG93czoKCjEuIGZpbmQgdGhlIHJhbmstMSBQTUQgYXMgYmVmb3JlOiAkXHRpbGRle1xtYXRoYmZ7WH19XzE9XGRlbHRhXzFcbWF0aGJme3V9XzFcbWF0aGJme3Z9XzFedCQ7CgoyLiBzZXQgJGo9MSQ7CgozLiBjb21wdXRlIFxbClx0aWxkZXtcbWF0aGJme1h9fV97aisxfSA9IFxtYXRoYmZ7WH0tXHRpbGRle1xtYXRoYmZ7WH19XzEtXGNkb3RzIC0gXHRpbGRle1xtYXRoYmZ7WH19X2osClxdIGFuZCBjb21wdXRlIHRoZSByYW5rLTEgUE1EIG9mICRcdGlsZGV7XG1hdGhiZntYfX1fe2orMX0kLCB3aGljaCBnaXZlcyAkXGRlbHRhX3tqKzF9LCBcbWF0aGJme3V9X3tqKzF9LCBcbWF0aGJme3Z9X3tqKzF9JDsKCjQuIGlmICRqPGskLCBpbmNyZWFzZSAkaiQgd2l0aCBvbmUgYW5kIGdvIGJhY2sgdG8gc3RlcCAzOyBvdGhlcndpc2UgZ28gdG8gc3RlcCA1OwoKNS4gdGhlIHJhbmstJGskIFBNRCBvZiAkXG1hdGhiZntYfSQgaXMgdGhlbiBnaXZlbiBieQogICBcWwogICAgIFxtYXRoYmZ7WH1fayA9IFxzdW1fe2o9MX1eayBcZGVsdGFfalxtYXRoYmZ7dX1falxtYXRoYmZ7dn1fal50LgogICBcXQoKV2l0aG91dCB0aGUgJExfMSQgY29uc3RyYWludHMsIHRoaXMgYWxnb3JpdGhtIGdpdmVzIHRoZSBvcmRpbmFyeSBTVkQuCgpBcyBiZWZvcmUgdGhlICRcZGVsdGFfaiRzLCAkXG1hdGhiZnt1fV9qJHMgYW5kICRcbWF0aGJme3Z9X2okcyBhcmUgc3RhY2tlZCBpbnRvIG1hdHJpY2VzICRcbWF0aGJme0R9X2skLCAkXG1hdGhiZntVfV9rJCBhbmQgJFxtYXRoYmZ7Vn1fayQ6ICRcbWF0aGJme1h9X2sgPSBcbWF0aGJme1V9X2tcbWF0aGJme0R9X2tcbWF0aGJme1Z9X2tedCQuCgoKTm90ZSB0aGF0IHRoZSAkXG1hdGhiZnt1fSQgdmVjdG9ycyBhcmUgZ2VuZXJhbGx5IG5vdCBvcnRob2dvbmFsIChpLmUuICRcbWF0aGJme3V9X2ledFxtYXRoYmZ7dX1falxuZXEgMCQgZm9yICRpXG5lcSBqJCkgKHRoZSBzYW1lIGhvbGRzIGZvciB0aGUgJFxtYXRoYmZ7dn0kIHZlY3RvcnMpLgoKLS0tCgojIyBTcGFyc2UgUENBIHZpYSBQTUQKCkp1c3QgbGlrZSB0aGUgU1ZEIGNhbiBiZSB1c2VkIHRvIGZpbmQgdGhlIFBDQSBzb2x1dGlvbiwgdGhlIFBNRCBjYW4gYmUgdXNlZCB0byBmaW5kIGEgc3BhcnNlIFBDQSBzb2x1dGlvbiAoU1BDKS4KCkZvciBhIFBDQSwgaXQgaXMgb25seSBpbXBvcnRhbnQgdG8gaGF2ZSBzcGFyc2UgbG9hZGluZ3MgKGluIHRoZSAkXG1hdGhiZnt2fSRzKTsgdGhlIHNjb3JlcyAoaW52b2x2aW5nIHRoZSAkXG1hdGhiZnt1fSRzKSBuZWVkIG5vdCBiZSBzcGFyc2UuCgpUaGUgcmFuay0xIHNvbHV0aW9ucyB0aHVzIHNhdGlzZnkKXFsKICBcbWluX3tcZGVsdGEsdSx2fSBcVmVydCBcbWF0aGJme1h9IC0gXGRlbHRhXG1hdGhiZnt1fVxtYXRoYmZ7dn1edFxWZXJ0X0ZeMiBcdGV4dHsgc3ViamVjdCB0byB9CiAgXGRlbHRhIFxnZXEgMCwgXFZlcnQgXG1hdGhiZnt1fVxWZXJ0XzJeMj1cVmVydCBcbWF0aGJme3Z9XFZlcnRfMl4yPTEsIFxWZXJ0IFxtYXRoYmZ7dn1cVmVydF8xIFxsZXEgYwpcXQooaS5lLiBubyBzcGFyc2l0eSBjb25zdHJhaW50IG9uICRcbWF0aGJme3V9JCkuCgpIZW5jZSB0aGUgUENBIHNjb3JlcwpcWwogXG1hdGhiZntafV9rID0gXG1hdGhiZntVfV9rXG1hdGhiZntEfV9rClxdCnJlbGF0ZSB0byAkXG1hdGhiZntYfV9rJCB0aHJvdWdoIHRoZSBzcGFyc2UgbG9hZGluZ3MgaW4gJFxtYXRoYmZ7Vn1fayQuCgoKLS0tCgpJdCBjYW4gYmUgc2hvd24gdGhhdCB0aGUgU1BDIHNvbHV0aW9uIChyYW5rLTEpIGFsc28gbWF4aW1pc2VzClxbCiAgXG1hdGhiZnt2fV50XG1hdGhiZntYfV50XG1hdGhiZntYfVxtYXRoYmZ7dn0gXHRleHR7IHN1YmplY3QgdG8gfQogIFxWZXJ0IFxtYXRoYmZ7dX1cVmVydF8yXjI9XFZlcnQgXG1hdGhiZnt2fVxWZXJ0XzJeMj0xLCBcVmVydCBcbWF0aGJme3Z9XFZlcnRfMSBcbGVxIGMKXF0KKGkuZS4gaXQgbWF4aW1pc2VzIHRoZSB2YXJpYW5jZSBvZiB0aGUgUENzLCBzdWJqZWN0IHRvIHNwYXJzaXR5IGNvbnN0cmFpbnQgb24gbG9hZGluZ3MpLgoKCkZyb20gdGhlc2UgdHdvIHNsaWRlcyB3ZSBtYXkgY29uY2x1ZGUgdGhhdCB3ZSBjYW4gdXNlIHRoZSBQTUQgYXMgdGhlIGJhc2lzIG9mIGEgc3BhcnNlIFBDQSwgYW5kIHRoYXQgdGhlIGludGVycHJldGF0aW9uIGlzIGFzIGJlZm9yZSBpbiB0ZXJtcyBvZiBtYXhpbWlzaW5nIHZhcmlhbmNlLiBPbmx5IG5vdyB3ZSBob3BlIHRoYXQgb25seSBhIGZldyBmZWF0dXJlcyB3aWxsIGdpdmUgYSBub24temVybyBsb2FkaW5nIGluIHRoZSAkXG1hdGhiZnt2fSQtdmVjdG9ycy4gQmlwbG90cyBtYXkgYWdhaW4gYmUgY29uc3RydWN0ZWQgKHdpdGggZmV3ZXIgdmVjdG9ycyB0byBiZSBwbG90dGVkKS4KCi0tLQoKIyBUb3hpY29nZW5vbWljcyBhbmFseXNpcyB3aXRoIGEgc3BhcnNlIFBDQQoKIyMgU1BDQQoKYGBge3J9CmxpYnJhcnkoUE1BKQoKc3BjWCA8LSBTUEMoCiAgdG94RGF0YVssLTFdICU+JQogICAgYXMubWF0cml4LAogIEs9MzAsCiAgc3VtYWJzdiA9IDUpCgpwYXIobWZyb3c9YygxLDIpKQpiYXJwbG90KHNwY1gkZF4yLHlsYWI9ImVpZ2VudmFsdWUiLGNleC5sYWI9MS41KQpiYXJwbG90KHNwY1gkcHJvcC52YXIuZXhwbGFpbmVkLAogICAgIHlsYWI9ImN1bW11bGF0aXZlIHZhcmlhbmNlIixjZXgubGFiPTEuNSkKCmBgYAoKCi0gVGhlIHBsb3Qgb24gdGhlIGxlZnQgc2hvd3MgdGhlIGVpZ2VudmFsdWVzIChzcXVhcmVkIHNpbmd1bGFyIHZhbHVlcykgZnJvbSB0aGUgUE1ELgoKICAtIFRoaXMgc3VnZ2VzdHMgdGhhdCB0aGUgZmlyc3Qgb25lIG9yIHR3byBhcmUgdGhlIG1vc3QgaW1wb3J0YW50LCBidXQgYWxsIGVpZ2VudmFsdWVzIHJlbWFpbiBzdWJzdGFudGlhbGx5IGxhcmdlciB0aGFuIHplcm8uCgotIFRoZSBmaWd1cmUgb24gdGhlIHJpZ2h0IHNob3dzIHRoZSBjdW11bGF0aXZlIHBlcmNlbnRhZ2Ugb2YgdmFyaWFuY2UgcmV0YWluZWQgaW4gdGhlIFBDcy4KCiAgICAtIFRoZXNlIHBlcmNlbnRhZ2VzIGFyZSBub3cgbm8gbG9uZ2VyIGNhbGN1bGF0ZWQgYXMgYmVmb3JlIGFzIHJhdGlvJ3Mgb2Ygc3VtcyBvZiBlaWdlbnZhbHVlcy4KICAgIC0gQSBtb3JlIGNvbXBsaWNhdGVkIGNhbGN1bGF0aW9uIGlzIHJlcXVpcmVkIG5vdywgYmVjYXVzZSB0aGUgUENzIGFyZSBubyBsb25nZXIgdW5jb3JyZWxhdGVkIHdpdGggb25lIGFub3RoZXIuCiAgICAtIFRodXMgcGFydCBvZiB0aGUgaW5mb3JtYXRpb24gKHZhcmlhbmNlKSBvZiBvbmUgUEMgaXMgc2hhcmVkIHdpdGggcGFydCBvZiB0aGUgaW5mb3JtYXRpb24gb2YgYW5vdGhlciBQQ3MgKGkuZS4gbm9uLXplcm8gY29ycmVsYXRpb24gb3IgY292YXJpYW5jZSkuCgojIyBMb2FkaW5nCgpMb2FkaW5ncyBvZiB0aGUgZmlyc3QgdHdvIFBDcywgd2l0aCBjb25zdHJhaW50ICRcVmVydFxtYXRoYmZ7dn1cVmVydF8xIDwgNSQuCgpgYGB7cn0KayA8LSAyClZrIDwtIHNwY1gkdlssMTprXQpjb2xuYW1lcyhWaykgPC0gcGFzdGUwKCJWIiwxOmspCgpncmlkLmFycmFuZ2UoCiAgVmsgJT4lCiAgICBhcy5kYXRhLmZyYW1lICU+JQogICAgbXV0YXRlKGdlbmVJRCA9IDE6bnJvdyhWaykpICU+JQogICAgZ2dwbG90KGFlcyh4ID0gZ2VuZUlELCB5ID0gVjEpKSArCiAgICBnZW9tX3BvaW50KHBjaD0yMSkgKwogICAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gYygtMiwwLDIpKnNkKFZrWywxXSksIGNvbCA9ICJyZWQiKSAsCiAgVmsgJT4lCiAgICBhcy5kYXRhLmZyYW1lICU+JQogICAgbXV0YXRlKGdlbmVJRCA9IDE6bnJvdyhWaykpICU+JQogICAgZ2dwbG90KGFlcyh4ID0gZ2VuZUlELCB5ID0gVjIpKSArCiAgICBnZW9tX3BvaW50KHBjaD0yMSkgKwogICAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gYygtMiwwLDIpKnNkKFZrWywyXSksIGNvbCA9ICJyZWQiKSwKICBuY29sPTIpCmBgYAoKVGhlc2UgcGxvdHMgc2hvdyB0aGUgbG9hZGluZ3Mgb2YgdGhlIGZpcnN0IHR3byBzcGFyc2UgUENzLiBNYW55IG9mIHRoZSBsb2FkaW5ncyBhcmUgbm93IGV4YWN0bHkgZXF1YWwgdG8gemVyby4gT25seSBmZXcgZ2VuZXMgc2hvdyBsYXJnZSBsb2FkaW5ncy4KCiMjIENoYW5nZSBjb25zdHJhaW50CgpXZSBub3cgcmVwZWF0IHRoZSBhbmFseXNpcywgYnV0IHdpdGggdGhlIGNvbnN0cmFpbnQgJFxWZXJ0IFxtYXRoYmZ7dn0gXFZlcnRfMSA8IDEkLiBUaGlzIGdpdmVzIGEgbXVjaCBzcGFyc2VyIHNvbHV0aW9uIHdpdGggb25seSB0d28gZ2VuZXMgd2l0aCBub24temVybyBsb2FkaW5ncyBpbiBlYWNoIGRpbWVuc2lvbi4KCmBgYHtyfQoKc3BjWDEgPC0gU1BDKAogIHRveERhdGFbLC0xXSAlPiUKICAgIGFzLm1hdHJpeCwKICBLPTMwLAogIHN1bWFic3YgPSAxKQoKayA8LSAyClZrIDwtIHNwY1gxJHZbLDE6a10KY29sbmFtZXMoVmspIDwtIHBhc3RlMCgiViIsIDE6aykKCmdyaWQuYXJyYW5nZSgKICBWayAlPiUKICAgIGFzLmRhdGEuZnJhbWUgJT4lCiAgICBtdXRhdGUoZ2VuZUlEID0gMTpucm93KFZrKSkgJT4lCiAgICBnZ3Bsb3QoYWVzKHggPSBnZW5lSUQsIHkgPSBWMSkpICsKICAgIGdlb21fcG9pbnQocGNoPTIxKSArCiAgICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSBjKC0yLDAsMikqc2QoVmtbLDFdKSwgY29sID0gInJlZCIpICwKICBWayAlPiUKICAgIGFzLmRhdGEuZnJhbWUgJT4lCiAgICBtdXRhdGUoZ2VuZUlEID0gMTpucm93KFZrKSkgJT4lCiAgICBnZ3Bsb3QoYWVzKHggPSBnZW5lSUQsIHkgPSBWMikpICsKICAgIGdlb21fcG9pbnQocGNoPTIxKSArCiAgICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSBjKC0yLDAsMikqc2QoVmtbLDJdKSwgY29sID0gInJlZCIpLAogIG5jb2w9MikKYGBgCgotLS0KCldlIG5vdyByZXBlYXQgdGhlIGFuYWx5c2lzLCBidXQgd2l0aCB0aGUgY29uc3RyYWludCAkXFZlcnQgXG1hdGhiZnt2fSBcVmVydF8xIDwgMTAkLiBUaGlzIGdpdmVzIGEgbXVjaCBsZXNzIHNwYXJzZSBzb2x1dGlvbiB3aXRoIHNldmVyYWwgZ2VuZXMgd2l0aCBub24temVybyBsb2FkaW5ncy4KCmBgYHtyfQpzcGNYMTAgPC0gU1BDKAogIHRveERhdGFbLC0xXSAlPiUKICAgIGFzLm1hdHJpeCwKICBLPTMwLAogIHN1bWFic3YgPSAxMCkKCmsgPC0gMgpWayA8LSBzcGNYMTAkdlssMTprXQpjb2xuYW1lcyhWaykgPC0gcGFzdGUwKCJWIiwxOmspCgpncmlkLmFycmFuZ2UoCiAgVmsgJT4lCiAgICBhcy5kYXRhLmZyYW1lICU+JQogICAgbXV0YXRlKGdlbmVJRCA9IDE6bnJvdyhWaykpICU+JQogICAgZ2dwbG90KGFlcyh4ID0gZ2VuZUlELCB5ID0gVjEpKSArCiAgICBnZW9tX3BvaW50KHBjaD0yMSkgKwogICAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gYygtMiwwLDIpKnNkKFZrWywxXSksIGNvbCA9ICJyZWQiKSAsCiAgVmsgJT4lCiAgICBhcy5kYXRhLmZyYW1lICU+JQogICAgbXV0YXRlKGdlbmVJRCA9IDE6bnJvdyhWaykpICU+JQogICAgZ2dwbG90KGFlcyh4ID0gZ2VuZUlELCB5ID0gVjIpKSArCiAgICBnZW9tX3BvaW50KHBjaD0yMSkgKwogICAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gYygtMiwwLDIpKnNkKFZrWywyXSksIGNvbCA9ICJyZWQiKSwKICBuY29sPTIpCmBgYAoKLS0tCgojIyBWYXJpYW5jZSBleHBsYWluZWQKClZhcmlhbmNlIGV4cGxhaW5lZCBmb3IgJGM9MSw1LDEwJCBhbmQgJCtcaW5mdHkkLgoKYGBge3J9CmRhdGEuZnJhbWUoCiAgUENzID0gMTozMCwKICAiYzEiID0gc3BjWDEkcHJvcC52YXIuZXhwbGFpbmVkLAogICJjNSIgPSBzcGNYJHByb3AudmFyLmV4cGxhaW5lZCwKICAiYzEwIiA9IHNwY1gxMCRwcm9wLnZhci5leHBsYWluZWQsCiAgImNvbnZlbnRpb25hbCIgPSBjdW1zdW0oc3ZkWCRkXjIpL3N1bShzdmRYJGReMikKICApICU+JQogIGdhdGhlcigibWV0aG9kIiwidmFyRXhwbCIsLTEpICU+JQogIGdncGxvdChhZXMoeCA9IFBDcywgeSA9IHZhckV4cGwsIGNvbG9yID0gbWV0aG9kKSkgKwogIGdlb21fbGluZSgpICsKICBnZW9tX3BvaW50KCkgKwogIHlsYWIoIlZhcmlhbmNlIGV4cGxhaW5lZCAoJSkiKQpgYGAKClRoaXMgZ3JhcGggaWxsdXN0cmF0ZXMgdGhhdCB0aGUgcGVyY2VudGFnZXMgb2YgdmFyaWFuY2UgZXhwbGFpbmVkIGJ5IHRoZSBQQ3MgYXJlIHNtYWxsZXIgZm9yIHNwYXJzZXIgc29sdXRpb25zLiBUaHVzIGluIGNob29zaW5nIGFuIGFwcHJvcHJpYXRlIHBlbmFsdHkgcGFyYW1ldGVyICRjXzIkIG9uZSBzaG91bGQgbm90IG9ubHkgbG9vayBhdCB0aGUgc3BhcnNlbmVzcyBvZiB0aGUgc29sdXRpb24sIGJ1dCAgYWxzbyBhdCB0aGUgcGVyY2VudGFnZSBvZiB2YXJpYW5jZSBjb250YWluZWQgaW4gdGhlIGZpcnN0IGZldyBQQ3MuIElmIHRoaXMgcGVyY2VudGFnZSBpcyB2ZXJ5IHNtYWxsLCB0aGVuIHRoZSBncmFwaHMgb2YgdGhlIHNjb3JlcyAob3IgYmlwbG90cykgYXJlIG5vIGxvbmdlciB2ZXJ5IGluZm9ybWF0aXZlIChpLmUuIHRoZXkgd2lsbCBub3QgdGVsbCB0aGUgZnVsbCBzdG9yeSkuIFRodXMgYSBjb21wcm9taXNlIG11c3QgYmUgbG9va2VkIGZvci4KCmBgYHtyfQpsaWJyYXJ5KGxhdGV4MmV4cCkKClVrNSA8LSBzcGNYJHVbLDE6a10KRGs1IDwtIGRpYWcoc3BjWCRkWzE6a10pClprNSA8LSBVazUlKiVEazUKY29sbmFtZXMoWms1KSA8LSBwYXN0ZTAoIloiLDE6aykKCnNwYzUgPC0gWms1ICU+JQogIGFzLmRhdGEuZnJhbWUgJT4lCiAgbXV0YXRlKEJBID0gdG94RGF0YSAlPiUgcHVsbChCQSkpICU+JQogIGdncGxvdChhZXMoeD0gWjEsIHkgPSBaMiwgY29sb3IgPSBCQSkpICsKICBnZW9tX3BvaW50KHNpemUgPSAzKSArCiAgc2NhbGVfY29sb3VyX2dyYWRpZW50Mihsb3cgPSAiYmx1ZSIsbWlkPSJ3aGl0ZSIsaGlnaD0icmVkIikgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDMsIHBjaCA9IDIxLCBjb2xvciA9ICJibGFjayIpICsKICBnZ3RpdGxlKFRlWCgiJGNfMiA9IDUkIikpCgpVazEgPC0gc3BjWDEkdVssMTprXQpEazEgPC0gZGlhZyhzcGNYMSRkWzE6a10pClprMSA8LSBVazElKiVEazEKY29sbmFtZXMoWmsxKSA8LSBwYXN0ZTAoIloiLDE6aykKCnNwYzEgPC0gWmsxICU+JQogIGFzLmRhdGEuZnJhbWUgJT4lCiAgbXV0YXRlKEJBID0gdG94RGF0YSAlPiUgcHVsbChCQSkpICU+JQogIGdncGxvdChhZXMoeD0gWjEsIHkgPSBaMiwgY29sb3IgPSBCQSkpICsKICBnZW9tX3BvaW50KHNpemUgPSAzKSArCiAgc2NhbGVfY29sb3VyX2dyYWRpZW50Mihsb3cgPSAiYmx1ZSIsbWlkPSJ3aGl0ZSIsaGlnaD0icmVkIikgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDMsIHBjaCA9IDIxLCBjb2xvciA9ICJibGFjayIpICsKICBnZ3RpdGxlKFRlWCgiJGNfMiA9IDEkIikpCgpVazEwIDwtIHNwY1gxMCR1WywxOmtdCkRrMTAgPC0gZGlhZyhzcGNYMTAkZFsxOmtdKQpaazEwIDwtIFVrMTAlKiVEazEwCmNvbG5hbWVzKFprMTApIDwtIHBhc3RlMCgiWiIsMTprKQoKc3BjMTAgPC0gWmsxMCAlPiUKICBhcy5kYXRhLmZyYW1lICU+JQogIG11dGF0ZShCQSA9IHRveERhdGEgJT4lIHB1bGwoQkEpKSAlPiUKICBnZ3Bsb3QoYWVzKHg9IFoxLCB5ID0gWjIsIGNvbG9yID0gQkEpKSArCiAgZ2VvbV9wb2ludChzaXplID0gMykgKwogIHNjYWxlX2NvbG91cl9ncmFkaWVudDIobG93ID0gImJsdWUiLG1pZD0id2hpdGUiLGhpZ2g9InJlZCIpICsKICBnZW9tX3BvaW50KHNpemUgPSAzLCBwY2ggPSAyMSwgY29sb3IgPSAiYmxhY2siKSArCiAgZ2d0aXRsZShUZVgoIiRjXzIgPSAxMCQiKSkKCmdyaWQuYXJyYW5nZShzcGMxLCBzcGM1LCBzcGMxMCwgcGNhICsgZ2d0aXRsZShUZVgoIiRjXzIgPSBcXGluZnR5IikpLCBuY29sID0gMikKYGBgCgpGaW5hbGx5IHdlIHNob3cgdGhlIHBsb3RzIG9mIHRoZSBzY29yZXMgb24gdGhlIGZpcnN0IHR3byBzcGFyc2UgUENzIGZvciAkY18yPTEkICh0b3AtbGVmdCksICRjXzI9NSQgKHRvcC1yaWdodCkgYW5kICRjXzI9MTAkIChib3R0b20tbGVmdCkgYW5kICRjXzI9XGluZnR5JCAoYm90dG9tLXJpZ2h0LCBjb252ZW50aW9uIFNWRCkuCgpOb3RlLCB0aGF0IHRoZSBtb3N0IHNwYXJzZSBzb2x1dGlvbiAodG9wLWxlZnQpIHNob3dzIGEgc3Ryb25nIHBvc2l0aXZlIGNvcnJlbGF0aW9uIGJldHdlZW4gdGhlIGZpcnN0IHR3byBQQ3MgKGFzIGEgY29uc2VxdWVuY2Ugb2YgdGhlIGxvc3Mgb2Ygb3J0aG9nb25hbGl0eSBvZiB0aGUgc2luZ3VsYXIgdmVjdG9ycykuCgpBbGwgZ3JhcGhzIHN1Y2NlZWQgcXVpdGUgd2VsbCBpbiBzZXBhcmF0aW5nIHRoZSB0b3hpYyBmcm9tIHRoZSBub24tdG94aWMgY29tcG91bmRzIGJhc2VkIG9uIHRoZWlyIGdlbmUgZXhwcmVzc2lvbi4KCi0gSGVuY2UsIHdlIG1heSBleHBlY3QgdGhhdCB0aGUgdHdvIGdlbmVzIGlkZW50aWZpZWQgZnJvbSB0aGUgbW9zdCBzcGFyc2Ugc29sdXRpb24gcGxheSBhbiBpbXBvcnRhbnQgcm9sZSBpbiB0aGUgZGV2ZWxvcG1lbnQgb2YgdG94aWMgZWZmZWN0cy4KCi0gTm90ZSwgaG93ZXZlciwgdGhhdCBvdXIgZGF0YSBhbmFseXNpcyBkaWQgbm90IHByb3ZpZGUgYSBzY2llbnRpZmljIHByb29mIGZvciB0aGlzIGNvbmNsdXNpb246IChzcGFyc2UpIFBDQSBpcyBvbmx5IGFuIGV4cGxvcmF0b3J5IG9yIGRlc2NyaXB0aXZlIGRhdGEgYW5hbHlzaXMgbWV0aG9kIHRoYXQgaGVscHMgdGhlIGRhdGEtYW5hbHlzdCB0byBnYWluIGluc2lnaHQgaW50byB0aGUgZGF0YS4KCi0gVGhlIGZhY3QgdGhhdCB3ZSBmb3VuZCBhIGZldyBnZW5lcyB0aGF0IGFwcGVhciB0byBiZSBhc3NvY2lhdGVkIHdpdGggdG94aWNpdHkgaXMgb2YgY291cnNlIGEgbmljZSByZXN1bHQuCgotIEl0IGlzIGltcG9ydGFudCB0byB1bmRlcnN0YW5kIHRoYXQgdGhlIHRveGljaXR5IG91dGNvbWUgd2FzIG5vdCB1c2VkIGluIHRoZSAoc3BhcnNlKSBQQ0EuIFdlIG9ubHkgdXNlZCB0aGUgdG94aWNpdHkgdG8gY29sb3IgdGhlIHBvaW50cyBpbiB0aGUgZ3JhcGhzLiBQQ0EgaXMgYW4gdW5zdXBlcnZpc2VkIG1ldGhvZC4KCiMgQWNrbm93bGVkZ2VtZW50IHstfQoKLSBPbGl2aWVyIFRoYXMgZm9yIHNoYXJpbmcgaGlzIG1hdGVyaWFscyBvZiBBbmFseXNpcyBvZiBIaWdoIERpbWVuc2lvbmFsIERhdGEgMjAxOS0yMDIwLCB3aGljaCBJIHVzZWQgYXMgdGhlIHN0YXJ0aW5nIHBvaW50IGZvciB0aGlzIGNoYXB0ZXIuICAKCiMgU2Vzc2lvbiBpbmZvIHstfQoKPGRldGFpbHM+PHN1bW1hcnk+U2Vzc2lvbiBpbmZvPC9zdW1tYXJ5PgoKYGBge3Igc2Vzc2lvbl9pbmZvLCBlY2hvPUZBTFNFLCBjYWNoZT1GQUxTRX0KU3lzLnRpbWUoKQpzZXNzaW9uaW5mbzo6c2Vzc2lvbl9pbmZvKCkKYGBgCgo8L2RldGFpbHM+Cg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("sparseSvd.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
